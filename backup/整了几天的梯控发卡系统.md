### åˆè¡· 
è™½è¯´è¿™æ ·ç³»ç»Ÿæ²¡ä»€ä¹ˆç ”ç©¶ä»·å€¼äº†ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œé‡åˆ°ä¸€ä¸ªå·®ç‚¹å°±è§£ä¸å¼€å¡äº†ã€‚å¥½åœ¨æœ‰æƒŠæ— é™©çš„è§£å¼€äº† 
ç³»ç»Ÿä¸ºäº’è”åˆ›ï¼Œæ²¡å¼€å¯æ»šåŠ¨ä½ ï¼Œä¸€å¡ä¸€å¯†çš„ç³»ç»Ÿ ï¼Œä¹Ÿå¯ä»¥åˆå§‹æ»šåŠ¨ä½ã€‚
é—®åˆ«é—®è¦äº†ä¸ªå¯†é’¥è®¡ç®—è½¯ä»¶ï¼Œå¥½åœ¨è¿˜æœ‰ä¸ªç®—æ³•è¡¨ ï¼ŒåŸºäºè¿™ä¸ªç®—æ³•è¡¨ ä½¿ç”¨python æ•´å‡ºäº†è½¯ä»¶ï¼Œ
### å¥‡æ€ªçš„BUG 
è™½ç„¶æå‡ºæ¥äº†ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†è¿˜æ˜¯ç®—çš„å¯¹ ï¼Œåªæ˜¯æœ‰çš„ç‰¹æ®Šå­—èŠ‚å¯†é’¥ä¼šç®—é”™ï¼Œæä¸æ‡‚ å‹‰å¼ºè¿™æ ·ç”¨å§ï¼
è¿˜è·Ÿæ®ç®—æ³•æ·»åŠ äº†åæ¨å›­åŒºç åŠŸèƒ½ã€‚å’±ä¹Ÿæ²¡éªŒè¯è¿™ä¸ªåŠŸèƒ½å‡†ç¡®ä¸å‡†ç¡®ï¼Œä½†æ˜¯åŸºäºæ ·æœ¬åæ¨å‡ºæ¥çš„åŸºæœ¬æ˜¯å‡†ç¡®çš„ï¼Œæœ‰å¾…éªŒè¯ã€‚
### è´´å‡ºä»£ç ä½œä¸ºå¤‡ä»½ï¼
åç»­å¦‚æœç®—æ³•å®Œå–„äº†ï¼Œåç»­åŸºäºæœ¬ä»£ç ç»§ç»­æ·»åŠ ä¼˜åŒ–ï¼
###  å·²ä¿®å¤ BUG
~~~
import tkinter as tk
from tkinter import messagebox, ttk
import pyperclip

class InterlinkDeepFixTool:
    def __init__(self, root):
        self.root = root
        self.root.title("äº’è”åˆ›")
        
        # çª—å£å°ºå¯¸ 600x750
        self.root.geometry("600x750") 
        self.root.configure(bg="#ECEFF1")
        
        # æ ¸å¿ƒæ˜ å°„é€»è¾‘
        self.MAP_P1 = {'0':'B','1':'C','2':'D','3':'E','4':'B','5':'C','6':'D','7':'E','8':'3','9':'4','A':'5','B':'6','C':'3','D':'4','E':'5','F':'6'}
        self.MAP_P3_BASE = {
            '0':('A','B'), '1':('A','B'), '2':('C','D'), '3':('C','D'),
            '4':('A','B'), '5':('A','B'), '6':('C','D'), '7':('C','D'),
            '8':('2','3'), '9':('2','3'), 'A':('4','5'), 'B':('4','5'),
            'C':('2','3'), 'D':('2','3'), 'E':('4','5'), 'F':('4','5')
        }
        self.MAP_P4 = {'0':'E','1':'E','2':'0','3':'0','4':'2','5':'2','6':'4','7':'4','8':'6','9':'6','A':'8','B':'8','C':'A','D':'A','E':'C','F':'C'}

        self.setup_styles()
        self.setup_ui()

    def setup_styles(self):
        self.style = ttk.Style()
        self.style.theme_use('clam')
        self.style.configure("TNotebook", background="#ECEFF1", borderwidth=0)
        self.style.configure("TNotebook.Tab", font=('å¾®è½¯é›…é»‘', 10), padding=[12, 5], background="#CFD8DC")
        self.style.map("TNotebook.Tab", background=[("selected", "#263238")], foreground=[("selected", "white")])

    def setup_ui(self):
        # é¡¶éƒ¨æ ‡é¢˜æ 
        header = tk.Frame(self.root, bg="#263238", height=50)
        header.pack(fill='x')
        tk.Label(header, text="äº’è”åˆ›å¯†é’¥åæ¨å·¥å…·", fg="#80D8FF", bg="#263238", font=('å¾®è½¯é›…é»‘', 12, 'bold')).pack(pady=12)

        # ä¸»å®¹å™¨
        self.notebook = ttk.Notebook(self.root)
        self.notebook.pack(expand=True, fill='both', padx=15, pady=10)

        # --- é¡µé¢ 1ï¼šæ­£å‘è®¡ç®— ---
        fwd_page = tk.Frame(self.notebook, bg="white", padx=25, pady=20)
        self.notebook.add(fwd_page, text=" ğŸ”’ æ­£å‘è®¡ç®— ")

        # ç§»é™¤äº†æç¤ºæ–‡å­—
        self.f_card = self.create_clean_input(fwd_page, "å¡å· ")
        self.f_park = self.create_clean_input(fwd_page, "å›­åŒºç ")

        tk.Button(fwd_page, text="å¼€å§‹è®¡ç®—å¯†é’¥", command=self.run_fwd, 
                  bg="#0288D1", fg="white", font=('å¾®è½¯é›…é»‘', 11, 'bold'), 
                  relief='flat', cursor='hand2', activebackground="#01579B", pady=8).pack(fill='x', pady=20)

        res_container = tk.LabelFrame(fwd_page, text=" è¾“å‡ºç»“æœ ", bg="white", font=('å¾®è½¯é›…é»‘', 9))
        res_container.pack(fill='x', pady=10)
        self.f_res = tk.Entry(res_container, font=('Consolas', 22, 'bold'), fg="#D32F2F", justify='center', bg="#F5F5F5", bd=0)
        self.f_res.pack(fill='x', padx=15, pady=15)
        
        tk.Button(fwd_page, text="å¤åˆ¶ç»“æœ", command=lambda: self.copy_to_clip(self.f_res.get()), 
                  fg="#546E7A", bg="white", bd=0, font=('å¾®è½¯é›…é»‘', 9, 'underline'), cursor='hand2').pack()

        # --- é¡µé¢ 2ï¼šé€†å‘åæ¨ ---
        rev_page = tk.Frame(self.notebook, bg="white", padx=15, pady=10)
        self.notebook.add(rev_page, text=" ğŸ”“ å›­åŒºç åæ¨ ")

        sample_frame = tk.LabelFrame(rev_page, text=" æ ·æœ¬é‡‡é›† (å¡å· -> å¯¹åº”å¯†é’¥) ", bg="white", font=('å¾®è½¯é›…é»‘', 9), padx=10, pady=10)
        sample_frame.pack(fill='x')

        self.rev_samples = []
        for i in range(3):
            row = tk.Frame(sample_frame, bg="white")
            row.pack(fill='x', pady=5)
            tk.Label(row, text=f"#{i+1}", bg="white", font=('Consolas', 10, 'bold'), width=3).pack(side='left')
            
            c_ent = tk.Entry(row, width=12, font=('Consolas', 11), bg="#F1F3F4", bd=0)
            c_ent.pack(side='left', padx=5, ipady=5)
            tk.Label(row, text="â†’", bg="white", font=('Arial', 10)).pack(side='left')
            k_ent = tk.Entry(row, font=('Consolas', 11), bg="#F1F3F4", bd=0)
            k_ent.pack(side='left', padx=5, ipady=5, fill='x', expand=True)
            self.rev_samples.append((c_ent, k_ent))

        tk.Button(rev_page, text="åæ¨å›­åŒºç ", command=self.run_rev, 
                  bg="#F57C00", fg="white", font=('å¾®è½¯é›…é»‘', 10, 'bold'), relief='flat', pady=5).pack(fill='x', pady=15)

        log_label = tk.Label(rev_page, text="åˆ†ææ—¥å¿—ä¸å€™é€‰å€¼:", bg="white", font=('å¾®è½¯é›…é»‘', 8), fg="#78909C")
        log_label.pack(anchor='w')
        self.rev_log = tk.Text(rev_page, height=12, font=('Consolas', 9), bg="#102027", fg="#64FFDA", padx=10, pady=10, bd=0)
        self.rev_log.pack(fill='both', expand=True)

    def create_clean_input(self, parent, label):
        """åˆ›å»ºä¸€ä¸ªæ²¡æœ‰æç¤ºæ–‡å­—çš„è¾“å…¥ç»„"""
        frame = tk.Frame(parent, bg="white")
        frame.pack(fill='x', pady=8)
        tk.Label(frame, text=label, bg="white", font=('å¾®è½¯é›…é»‘', 10, 'bold'), fg="#37474F").pack(anchor='w')
        ent = tk.Entry(frame, font=('Consolas', 12), bg="#F1F3F4", bd=0)
        ent.pack(fill='x', ipady=8, pady=5)
        tk.Frame(frame, height=2, bg="#CFD8DC").pack(fill='x')
        return ent

    def copy_to_clip(self, text):
        if text.strip():
            pyperclip.copy(text)
            messagebox.showinfo("æç¤º", "å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")

    def run_fwd(self):
        try:
            c, p = self.f_card.get().strip().upper(), self.f_park.get().strip().upper()
            if len(c) != 8 or len(p) != 8: raise ValueError("è¯·è¾“å…¥8ä½16è¿›åˆ¶æ•°æ®")
            cb = [int(c[i:i+2], 16) for i in range(0, 8, 2)]
            pb = [int(p[i:i+2], 16) for i in range(0, 8, 2)]
            p3_idx = 1 if c[3] not in ['0', '1'] else 0
            pre = f"{self.MAP_P1[c[0]]}0{self.MAP_P3_BASE[c[2]][p3_idx]}{self.MAP_P4[c[3]]}"
            b3, b4 = (cb[0]|pb[0])+(cb[2]&pb[0]), (cb[1]|pb[1])+(cb[3]&pb[1])
            res = f"{pre}{b3&0xFF:02X}{b4&0xFF:02X}{(cb[2]|pb[2])&0xFF:02X}{(cb[3]|pb[3])&0xFF:02X}"
            self.f_res.delete(0, tk.END); self.f_res.insert(0, res)
        except Exception as e: messagebox.showerror("é”™è¯¯", str(e))

    def run_rev(self):
        self.rev_log.delete('1.0', tk.END)
        try:
            samples = []
            for c_ent, k_ent in self.rev_samples:
                c, k = c_ent.get().strip().upper(), k_ent.get().strip().upper()
                if len(c) == 8 and len(k) == 12:
                    samples.append({'cb': [int(c[i:i+2], 16) for i in range(0, 8, 2)], 
                                   'kb': [int(k[i:i+2], 16) for i in range(0, 12, 2)]})
            
            if not samples:
                self.rev_log.insert(tk.END, "> è¯·è‡³å°‘è¾“å…¥ä¸€ç»„å®Œæ•´æ ·æœ¬ä»¥ä¾›åˆ†æ...")
                return

            self.rev_log.insert(tk.END, f"> æ­£åœ¨åˆ†æ {len(samples)} ç»„æ ·æœ¬...\n")
            park_bytes_cands = []
            for i in range(4):
                intersect_set = set()
                for idx, s in enumerate(samples):
                    cb, kb, cands = s['cb'], s['kb'], set()
                    for p in range(256):
                        if i == 0: val = ((cb[0]|p) + (cb[2]&p)) & 0xFF
                        elif i == 1: val = ((cb[1]|p) + (cb[3]&p)) & 0xFF
                        elif i == 2: val = (cb[2]|p) & 0xFF
                        else: val = (cb[3]|p) & 0xFF
                        if val == kb[i+2]: cands.add(f"{p:02X}")
                    if idx == 0: intersect_set = cands
                    else: intersect_set &= cands
                park_bytes_cands.append(sorted(list(intersect_set)))

            res_code = "".join([ (cl[0] if len(cl)==1 else (([n for n in cl if n.isdigit()]+cl)[0] if cl else "??")) for cl in park_bytes_cands])
            self.rev_log.insert(tk.END, f"\n[ è¯†åˆ«å‡ºçš„å›­åŒºç  ]: {res_code}\n")
            self.rev_log.insert(tk.END, "="*30 + "\nå­—èŠ‚å€™é€‰å€¼:\n")
            for i, l in enumerate(park_bytes_cands): 
                self.rev_log.insert(tk.END, f" P{i+1}: {', '.join(l) if l else 'æ— åŒ¹é…'}\n")
        except Exception as e: self.rev_log.insert(tk.END, f"\n[ å¼‚å¸¸ ]: {str(e)}")

if __name__ == "__main__":
    root = tk.Tk()
    app = InterlinkDeepFixTool(root)
    root.mainloop()


~~~
### å¸¦æ•°æ®ä¿®æ”¹ç‰ˆæœ¬
~~~
import tkinter as tk
from tkinter import messagebox, filedialog, ttk
import pyperclip
import binascii
import os  # ç”¨äºè·¨å¹³å°è·¯å¾„å¤„ç†

class InterlinkPocketTool:
    def __init__(self, root):
        self.root = root
        self.root.title("äº’è”åˆ›åŠ©æ‰‹")
        self.root.geometry("350x580")  # ä¿æŒåŸæœ‰å°ºå¯¸ä¸å˜
        self.root.configure(bg="#F2F2F7")
        self.root.resizable(False, False)  # ä¿æŒä¸å¯è°ƒæ•´å¤§å°
        
        # æ ¸å¿ƒæ˜ å°„é€»è¾‘ï¼ˆåŸæœ‰ - å®Œå…¨æœªä¿®æ”¹ï¼‰
        self.M1 = {'0':'B','1':'C','2':'D','3':'E','4':'B','5':'C','6':'D','7':'E','8':'3','9':'4','A':'5','B':'6','C':'3','D':'4','E':'5','F':'6'}
        self.M3 = {'0':('A','B'),'1':('A','B'),'2':('C','D'),'3':('C','D'),'4':('A','B'),'5':('A','B'),'6':('C','D'),'7':('C','D'),'8':('2','3'),'9':('2','3'),'A':('4','5'),'B':('4','5'),'C':('2','3'),'D':('2','3'),'E':('4','5'),'F':('4','5')}
        self.M4 = {'0':'E','1':'E','2':'0','3':'0','4':'2','5':'2','6':'4','7':'4','8':'6','9':'6','A':'8','B':'8','C':'A','D':'A','E':'C','F':'C'}

        # RFIDå·¥å…·ç›¸å…³å±æ€§ï¼ˆæ–°å¢ï¼‰
        self.raw_data = bytearray()
        self.current_file_path = ""
        self.XOR_KEY = "530518"
        self.hlc3_tag = b"\xB8\xA5\xC1\xAA\xB4\xB4"
        self.tuwen_sector = None
        self.hlc3_sector = None

        self.setup_ui()

    def setup_ui(self):
        # åˆ›å»ºä¸»æ ‡ç­¾é¡µå®¹å™¨ï¼ˆä»…æ–°å¢æ­¤å®¹å™¨ï¼ŒåŸæœ‰ç»“æ„åµŒå¥—å…¶ä¸­ï¼‰
        main_notebook = ttk.Notebook(self.root)
        main_notebook.pack(fill='both', expand=True, padx=5, pady=5)
        
        # ========== åŸæœ‰åŠŸèƒ½é¢æ¿ï¼ˆå®Œå…¨æœªä¿®æ”¹ï¼‰ ==========
        original_frame = tk.Frame(main_notebook, bg="#F2F2F7")
        main_notebook.add(original_frame, text="å¯†é’¥è®¡ç®—")
        
        # --- æ­£å‘è®¡ç®—åŒº (åŸæœ‰ - å®Œå…¨æœªä¿®æ”¹) ---
        f_frame = tk.LabelFrame(original_frame, text=" ğŸ”’ å¯†é’¥è®¡ç®— ", bg="white", font=('å¾®è½¯é›…é»‘', 9, 'bold'), padx=10, pady=5)
        f_frame.pack(fill='x', padx=10, pady=5)

        tk.Label(f_frame, text="å¡å· / å›­åŒºç ", bg="white", font=('å¾®è½¯é›…é»‘', 8), fg="#666").pack(anchor='w')
        row1 = tk.Frame(f_frame, bg="white")
        row1.pack(fill='x')
        self.f_card = tk.Entry(row1, font=('Consolas', 10), bg="#F2F2F7", bd=0, justify='center')
        self.f_card.pack(side='left', fill='x', expand=True, ipady=4, padx=2)
        self.f_park = tk.Entry(row1, font=('Consolas', 10), bg="#F2F2F7", bd=0, justify='center')
        self.f_park.pack(side='left', fill='x', expand=True, ipady=4, padx=2)

        tk.Button(f_frame, text="è®¡ç®—å¹¶å¤åˆ¶", command=self.run_fwd, bg="#007AFF", fg="white", 
                  font=('å¾®è½¯é›…é»‘', 9), relief='flat', pady=2).pack(fill='x', pady=8)
        
        self.f_res = tk.Entry(f_frame, font=('Consolas', 14, 'bold'), fg="#E91E63", 
                              justify='center', bg="#F9F9F9", bd=0)
        self.f_res.pack(fill='x', pady=2)

        # --- é€†å‘åæ¨åŒº (åŸæœ‰ - å®Œå…¨æœªä¿®æ”¹) ---
        r_frame = tk.LabelFrame(original_frame, text=" ğŸ”“ å›­åŒºç åæ¨ ", bg="white", font=('å¾®è½¯é›…é»‘', 9, 'bold'), padx=10, pady=5)
        r_frame.pack(fill='both', expand=True, padx=10, pady=5)

        tk.Label(r_frame, text="å¡å· â” å¯†é’¥ (æ”¯æŒç©ºæ ¼)", bg="white", font=('å¾®è½¯é›…é»‘', 8), fg="#666").pack(anchor='w')
        self.rev_samples = []
        for _ in range(3):
            row = tk.Frame(r_frame, bg="white")
            row.pack(fill='x', pady=1)
            c = tk.Entry(row, width=10, font=('Consolas', 9), bg="#F2F2F7", bd=0, justify='center')
            c.pack(side='left', padx=1, ipady=3)
            tk.Label(row, text="â†’", bg="white", font=('Arial', 8)).pack(side=tk.LEFT)
            k = tk.Entry(row, font=('Consolas', 9), bg="#F2F2F7", bd=0, justify='center')
            k.pack(side=tk.LEFT, padx=1, ipady=3, fill='x', expand=True)
            self.rev_samples.append((c, k))

        tk.Button(r_frame, text="åæ¨å›­åŒºç ", command=self.run_rev, bg="#34C759", fg="white", 
                  font=('å¾®è½¯é›…é»‘', 9), relief='flat', pady=2).pack(fill='x', pady=5)

        self.rev_log = tk.Text(r_frame, height=8, font=('Consolas', 8), bg="#1C1C1E", fg="#32D74B", 
                               padx=5, pady=5, bd=0)
        self.rev_log.pack(fill='both', expand=True)
        
        # ========== æ–°å¢RFIDå·¥å…·é¢æ¿ï¼ˆé€‚é…å°çª—å£ï¼‰ ==========
        rfid_frame = tk.Frame(main_notebook, bg="#F2F2F7")
        main_notebook.add(rfid_frame, text="æ•°æ®ä¿®æ”¹")
        
        # é¡¶éƒ¨æŒ‰é’®ï¼ˆé€‚é…å°çª—å£ï¼‰
        top = tk.Frame(rfid_frame, pady=5, bg="#F2F2F7")
        top.pack(fill=tk.X, padx=10)
        tk.Button(top, text="ğŸ“‚ è½½å…¥DUMP", command=self.load_file, bg="#2196F3", fg="white", 
                  font=('å¾®è½¯é›…é»‘', 8), padx=5).pack(side=tk.LEFT, padx=5)
        tk.Button(top, text="ğŸ’¾ ä¿å­˜", command=self.save_file, bg="#4CAF50", fg="white",
                  font=('å¾®è½¯é›…é»‘', 8), padx=5).pack(side=tk.LEFT)
        self.file_lab = tk.Label(top, text="æœªè½½å…¥æ–‡ä»¶", fg="gray", bg="#F2F2F7", font=('å¾®è½¯é›…é»‘', 7))
        self.file_lab.pack(side=tk.LEFT, padx=5)

        # çŠ¶æ€æ˜¾ç¤ºåŒº
        status_frame = tk.Frame(rfid_frame, bg="#F2F2F7")
        status_frame.pack(fill=tk.X, padx=10, pady=2)
        self.tw_stat = tk.Label(status_frame, text="ğŸ”´ ç­‰å¾…è½½å…¥æ–‡ä»¶", fg="red", bg="#F2F2F7", font=('å¾®è½¯é›…é»‘', 8))
        self.tw_stat.pack(anchor='w')
        self.hlc_stat = tk.Label(status_frame, text="ğŸ”´ æœªé€šè¿‡æ ¡éªŒ", fg="red", bg="#F2F2F7", font=('å¾®è½¯é›…é»‘', 8))
        self.hlc_stat.pack(anchor='w')

        # å›¾æ–‡é¢æ¿ï¼ˆé€‚é…å°çª—å£ï¼‰
        tw_g = tk.LabelFrame(rfid_frame, text=" äº’è”åˆ›2å˜ ", padx=5, pady=5, bg="white", font=('å¾®è½¯é›…é»‘', 8, 'bold'))
        tw_g.pack(fill=tk.X, padx=10, pady=2)
        
        self.tw_ents = {}
        for lab, key in [("å‘å¡æ—¶é—´:", "issue"), ("ä¸šä¸»æ—¶é—´:", "owner")]:
            r = tk.Frame(tw_g, bg="white"); r.pack(fill=tk.X, pady=1)
            tk.Label(r, text=lab, width=8, bg="white", font=('å¾®è½¯é›…é»‘', 7)).pack(side=tk.LEFT)
            e = tk.Entry(r, font=('Consolas', 8), bg="#F2F2F7", width=15)
            e.pack(side=tk.LEFT, padx=2)
            tk.Button(r, text="æ”¹", command=lambda k=key: self._modify_tuwen(k), 
                      bg="#007AFF", fg="white", font=('å¾®è½¯é›…é»‘', 7), width=3).pack(side=tk.RIGHT)
            self.tw_ents[key] = e

        # äº’è”åˆ›3é¢æ¿ï¼ˆé€‚é…å°çª—å£ï¼‰
        hlc_g = tk.LabelFrame(rfid_frame, text=" äº’è”åˆ›3  ", padx=5, pady=5, fg="blue", bg="white", font=('å¾®è½¯é›…é»‘', 8, 'bold'))
        hlc_g.pack(fill=tk.X, padx=10, pady=2)
        
        r_hlc = tk.Frame(hlc_g, bg="white"); r_hlc.pack(fill=tk.X, pady=2)
        tk.Label(r_hlc, text="ä¿®æ”¹æ—¶é—´:", width=8, bg="white", font=('å¾®è½¯é›…é»‘', 7)).pack(side=tk.LEFT)
        self.hlc_time_ent = tk.Entry(r_hlc, font=("Consolas", 9, "bold"), bg="#F2F2F7", width=15)
        self.hlc_time_ent.pack(side=tk.LEFT, padx=2)
        tk.Button(r_hlc, text="æ”¹", command=self._modify_hlc3, bg="#FF5722", fg="white",
                  font=('å¾®è½¯é›…é»‘', 7), width=3).pack(side=tk.RIGHT)

        # æ•°æ®æ˜¾ç¤ºåŒºï¼ˆé€‚é…å°çª—å£ï¼‰
        self.txt = tk.Text(rfid_frame, height=10, font=("Consolas", 7), state=tk.DISABLED)
        self.txt.pack(fill='both', expand=True, padx=10, pady=5)

    # ================= åŸæœ‰åŠŸèƒ½æ–¹æ³•ï¼ˆå®Œå…¨æœªä¿®æ”¹ï¼‰ =================
    def run_fwd(self):
        try:
            # è‡ªåŠ¨è¿‡æ»¤ç©ºæ ¼
            c = self.f_card.get().replace(" ", "").upper()
            p = self.f_park.get().replace(" ", "").upper()
            if len(c) != 8 or len(p) != 8: raise ValueError("éœ€8ä½16è¿›åˆ¶")
            cb = [int(c[i:i+2], 16) for i in range(0, 8, 2)]
            pb = [int(p[i:i+2], 16) for i in range(0, 8, 2)]
            p3_idx = 1 if c[3] not in ['0', '1'] else 0
            pre = f"{self.M1[c[0]]}0{self.M3[c[2]][p3_idx]}{self.M4[c[3]]}"
            b3, b4 = (cb[0]|pb[0])+(cb[2]&pb[0]), (cb[1]|pb[1])+(cb[3]&pb[1])
            res = f"{pre}{b3&0xFF:02X}{b4&0xFF:02X}{(cb[2]|pb[2])&0xFF:02X}{(cb[3]|pb[3])&0xFF:02X}"
            self.f_res.delete(0, tk.END)
            self.f_res.insert(0, res)
            pyperclip.copy(res)
        except Exception as e: messagebox.showerror("Error", str(e))

    def run_rev(self):
        self.rev_log.delete('1.0', tk.END)
        try:
            samples = []
            for c_ent, k_ent in self.rev_samples:
                c, k = c_ent.get().replace(" ", "").upper(), k_ent.get().replace(" ", "").upper()
                if len(c) == 8 and len(k) == 12:
                    samples.append({'cb':[int(c[i:i+2], 16) for i in range(0, 8, 2)], 
                                   'kb':[int(k[i:i+2], 16) for i in range(0, 12, 2)]})
            if not samples: return
            park_cands = []
            for i in range(4):
                intersect = set()
                for idx, s in enumerate(samples):
                    cb, kb, cands = s['cb'], s['kb'], set()
                    for p in range(256):
                        if i == 0: v = ((cb[0]|p) + (cb[2]&p)) & 0xFF
                        elif i == 1: v = ((cb[1]|p) + (cb[3]&p)) & 0xFF
                        elif i == 2: v = (cb[2]|p) & 0xFF
                        else: v = (cb[3]|p) & 0xFF
                        if v == kb[i+2]: cands.add(f"{p:02X}")
                    if idx == 0: intersect = cands
                    else: intersect &= cands
                park_cands.append(sorted(list(intersect)))
            res = "".join([(cl[0] if len(cl)==1 else (([n for n in cl if n.isdigit()]+cl)[0] if cl else "??")) for cl in park_cands])
            self.rev_log.insert(tk.END, f"å›­åŒºç : {res}\n" + "-"*15 + "\n")
            for i, l in enumerate(park_cands):
                self.rev_log.insert(tk.END, f"P{i+1}: {','.join(l)}\n")
        except Exception as e: self.rev_log.insert(tk.END, f"é”™è¯¯: {e}")

    # ================= ä»…ä¿®æ”¹äº’è”åˆ›3çš„2ä¸ªæ–¹æ³•ï¼Œå…¶ä½™å®Œå…¨æœªåŠ¨ =================
    def _modify_hlc3(self):
        if self.hlc3_sector is None:
            messagebox.showerror("é”™è¯¯", "æœªå®šä½åˆ°äº’è”åˆ›3æœ‰æ•ˆæ‰‡åŒº")
            return
            
        try:
            # 1. è·å–è¾“å…¥æ˜ç  (å¦‚ 991203)
            raw_input = self.hlc_time_ent.get().strip()
            if len(raw_input) != 6:
                raise ValueError("æ—¥æœŸå¿…é¡»æ˜¯6ä½åå…­è¿›åˆ¶å­—ç¬¦")
            
            # 2. 3å­—èŠ‚å®Œæ•´å¼‚æˆ–è®¡ç®—ï¼ˆæ ¸å¿ƒä¿®æ”¹ï¼šæ›¿æ¢åŸå•å­—èŠ‚é€»è¾‘ï¼‰
            # è¾“å…¥æ—¶é—´è½¬3å­—èŠ‚äºŒè¿›åˆ¶
            time_bytes = binascii.unhexlify(raw_input)  # å¦‚ 250430 â†’ b'\x25\x04\x30'
            # å¯†é’¥è½¬3å­—èŠ‚äºŒè¿›åˆ¶
            key_bytes = binascii.unhexlify(self.XOR_KEY)  # 530518 â†’ b'\x53\x05\x18'
            # 3å­—èŠ‚é€ä½å¼‚æˆ–
            xor_bytes = bytes([t ^ k for t, k in zip(time_bytes, key_bytes)])
            
            # 3. åŒæ­¥åå†™é€»è¾‘ï¼ˆæ ¸å¿ƒä¿®æ”¹ï¼šå†™å…¥3å­—èŠ‚å¼‚æˆ–ç»“æœï¼Œä¿ç•™åŸæç¤ºæ–‡æ¡ˆï¼‰
            base = self.hlc3_sector * 64
            
            # å†™å…¥3å­—èŠ‚å¼‚æˆ–ç»“æœåˆ° Off 01-03ï¼ˆæ›¿æ¢åŸä»…å†™Off03çš„é€»è¾‘ï¼‰
            self.raw_data[base+1:base+4] = xor_bytes
            # å†™å…¥3å­—èŠ‚æ—¶é—´æ˜ç åˆ° Off 04-06ï¼ˆåŸæœ‰é€»è¾‘ä¿ç•™ï¼‰
            self.raw_data[base+4:base+7] = time_bytes
            
            # 4. åˆ·æ–°ç•Œé¢å¹¶æç¤ºï¼ˆæç¤ºæ–‡æ¡ˆå®Œå…¨ä¿ç•™åŸæœ‰ï¼‰
            self._refresh_view()
            # è®¡ç®—ç¬¬ä¸€ä¸ªå¼‚æˆ–å­—èŠ‚ç”¨äºä¿ç•™åŸæœ‰æç¤ºæ ¼å¼ï¼ˆä»…ä¸ºå…¼å®¹æ–‡æ¡ˆï¼Œä¸å½±å“é€»è¾‘ï¼‰
            new_xor_checksum = xor_bytes[2]  # å–æœ€å1å­—èŠ‚åŒ¹é…åŸæç¤ºçš„"æ ¡éªŒä½"å±•ç¤º
            messagebox.showinfo("æˆåŠŸ", f"äº’è”åˆ›3ä¿®æ”¹æˆåŠŸï¼\næ ¡éªŒä½: {new_xor_checksum:02X}\næ—¥æœŸ: {raw_input}")
            
        except Exception as e:
            messagebox.showerror("é”™è¯¯", f"ä¿®æ”¹å¤±è´¥: {str(e)}")

    def _smart_locate(self):
        self.tuwen_sector = None
        self.hlc3_sector = None
        for s in range(len(self.raw_data)//64):
            base = s * 64
            b0 = self.raw_data[base : base+16]
            b3 = self.raw_data[base+48 : base+64]
            if b0[1:7] != b"\x00"*6 and b0[1:7] != b"\xFF"*6:
                self.tuwen_sector = s
                self.tw_stat.config(text=f"ğŸŸ¢ å®šä½æˆåŠŸ: æ‰‡åŒº {s}", fg="green")
                self._fill_tuwen()
            # äº’è”åˆ›3å®šä½é€»è¾‘ä¿®æ”¹ï¼š3å­—èŠ‚å®Œæ•´æ ¡éªŒï¼ˆæ›¿æ¢åŸå•å­—èŠ‚æ ¡éªŒï¼‰
            if self.hlc3_tag in b3:
                # è¯»å–3å­—èŠ‚å¼‚æˆ–å€¼ï¼ˆOff01-03ï¼‰å’Œ3å­—èŠ‚æ—¶é—´å€¼ï¼ˆOff04-06ï¼‰
                xor_bytes = self.raw_data[base+1:base+4]
                time_bytes = self.raw_data[base+4:base+7]
                key_bytes = binascii.unhexlify(self.XOR_KEY)
                try:
                    # 3å­—èŠ‚é€ä½å¼‚æˆ–æ ¡éªŒ
                    check_bytes = bytes([t ^ k for t, k in zip(time_bytes, key_bytes)])
                    if check_bytes == xor_bytes:
                        self.hlc3_sector = s
                        self.hlc_stat.config(text=f"ğŸŸ¢ æ ¡éªŒé€šè¿‡: æ‰‡åŒº {s}", fg="green")
                        self.hlc_time_ent.delete(0, tk.END)
                        self.hlc_time_ent.insert(0, time_bytes.hex().upper())
                except: continue

    # ================= ä»¥ä¸‹æ‰€æœ‰æ–¹æ³•å®Œå…¨æœªä¿®æ”¹ =================
    def _fill_tuwen(self):
        s = self.tuwen_sector
        b0 = self.raw_data[s*64 : s*64+16]
        issue_decoded = bytes([~b & 0xFF for b in b0[1:4]]).hex().upper()
        owner_decoded = bytes([~b & 0xFF for b in b0[4:7]]).hex().upper()
        self.tw_ents["issue"].delete(0, tk.END); self.tw_ents["issue"].insert(0, issue_decoded)
        self.tw_ents["owner"].delete(0, tk.END); self.tw_ents["owner"].insert(0, owner_decoded)

    def _modify_tuwen(self, key):
        if self.tuwen_sector is None: 
            messagebox.showwarning("æç¤º", "æœªå®šä½åˆ°å›¾æ–‡æ‰‡åŒº")
            return
        try:
            raw_input = self.tw_ents[key].get().strip()
            if len(raw_input) != 6:
                raise ValueError("å¿…é¡»è¾“å…¥6ä½åå…­è¿›åˆ¶å­—ç¬¦")
            hex_data = binascii.unhexlify(raw_input)
            inverted_data = bytes([~b & 0xFF for b in hex_data])
            off = self.tuwen_sector * 64
            if key == "issue": self.raw_data[off+1:off+4] = inverted_data
            elif key == "owner": self.raw_data[off+4:off+7] = inverted_data
            self._refresh_view()
            messagebox.showinfo("æˆåŠŸ", f"{key} ä¿®æ”¹æˆåŠŸ")
        except Exception as e: 
            messagebox.showerror("é”™è¯¯", str(e))

    def load_file(self):
        path = filedialog.askopenfilename(
            filetypes=[("DUMPæ–‡ä»¶", "*.dump"), ("æ‰€æœ‰æ–‡ä»¶", "*.*")]
        )
        if path:
            self.current_file_path = path
            try:
                with open(path, "rb") as f: 
                    self.raw_data = bytearray(f.read())
                self.file_lab.config(text=os.path.basename(path)[:10] + "..." if len(os.path.basename(path))>10 else os.path.basename(path))
                self._smart_locate()
                self._refresh_view()
                messagebox.showinfo("æˆåŠŸ", "æ–‡ä»¶è½½å…¥æˆåŠŸï¼")
            except Exception as e:
                messagebox.showerror("é”™è¯¯", f"è½½å…¥å¤±è´¥: {str(e)}")

    def _refresh_view(self):
        self.txt.config(state=tk.NORMAL)
        self.txt.delete("1.0", tk.END)
        if len(self.raw_data) > 0:
            # é€‚é…å°çª—å£ï¼Œåªæ˜¾ç¤ºå‰8ä¸ªæ‰‡åŒº
            show_sectors = min(len(self.raw_data)//64, 8)
            for s in range(show_sectors):
                self.txt.insert(tk.END, f"--- æ‰‡åŒº {s} ---\n")
                for b in range(4):
                    line = self.raw_data[s*64+b*16:s*64+b*16+16].hex(' ').upper()
                    self.txt.insert(tk.END, f"å—{b}: {line[:40]}\n")  # é™åˆ¶æ¯è¡Œé•¿åº¦
                self.txt.insert(tk.END, "\n")
        self.txt.config(state=tk.DISABLED)

    def save_file(self):
        if not self.raw_data:
            messagebox.showerror("é”™è¯¯", "æœªè½½å…¥ä»»ä½•DUMPæ–‡ä»¶ï¼")
            return
        
        try:
            path = filedialog.asksaveasfilename(
                initialfile=os.path.basename(self.current_file_path) if self.current_file_path else "modified.dump",
                defaultextension=".dump",
                filetypes=[("DUMPæ–‡ä»¶", "*.dump"), ("æ‰€æœ‰æ–‡ä»¶", "*.*")]
            )
            
            if path:
                with open(path, "wb") as f:
                    f.write(self.raw_data)
                self.current_file_path = path
                self.file_lab.config(text=os.path.basename(path)[:10] + "..." if len(os.path.basename(path))>10 else os.path.basename(path))
                messagebox.showinfo("æˆåŠŸ", f"æ–‡ä»¶ä¿å­˜æˆåŠŸï¼\n{path}")
                
        except Exception as e:
            messagebox.showerror("ä¿å­˜å¤±è´¥", f"é”™è¯¯: {str(e)}")

if __name__ == "__main__":
    root = tk.Tk()
    app = InterlinkPocketTool(root)
    root.mainloop()

~~~
