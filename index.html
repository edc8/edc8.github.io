<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark_colorblind" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" id="hljs-light">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" id="hljs-dark" disabled>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    
    <link rel="icon" href="https://avatars.githubusercontent.com/u/64282354?v=4">
    <script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
    <title>Hex Blog</title>
    <style>
        /* --- 背景修改部分 --- */
        html { 
            min-height: 100vh;
        }
        /* 根据明暗模式设置网页底色 */
        [data-color-mode="light"] html { background-color: #f6f8fa; }
        [data-color-mode="dark"] html { background-color: #0d1117; }

        body { 
            box-sizing: border-box; min-width: 200px; max-width: 900px; margin: 40px auto; padding: 45px; 
            font-size: 16px; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif; 
            line-height: 1.5; 
            /* 取消了毛玻璃，改用实色边框，彻底杜绝闪屏 */
            border: 1px solid var(--borderColor-muted); 
            border-radius: 20px; 
            box-shadow: 0 8px 24px rgba(0,0,0,0.1); 
            transition: background-color 0.3s;
            transform: translateZ(0);
        }
        [data-color-mode="light"] body { background-color: #ffffff !important; }
        [data-color-mode="dark"] body { background-color: #161b22 !important; }
        /* ------------------ */

        #header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted);margin-bottom: 24px;}
        .avatar {transition: 0.8s;width:64px;height:64px;object-fit: cover;}
        .avatar:hover{transform: scale(1.1) rotate(360deg);}
        .title-left{display:flex;align-items:center;}
        .title-left a{color:inherit;text-decoration:none;font-size:32px;font-weight: bold;font-family:Monaco;margin-left:8px;}
        .title-right{display:flex;margin:auto 0 0 auto;}
        .title-right .circle{padding: 12px; margin-left: 8px; cursor: pointer;}

        .SideNav-item { 
            display: flex !important; align-items: center !important; padding: 16px 20px !important; margin-bottom: 12px !important; 
            background-color: var(--color-canvas-subtle) !important; border: 1px solid var(--borderColor-muted) !important; 
            border-radius: 12px !important; transition: transform 0.2s, border-color 0.2s !important; 
            cursor: pointer; overflow: hidden; text-decoration: none !important;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }
        .SideNav-item:hover { border-color: var(--color-accent-emphasis) !important; }
        .SideNav-item:active { transform: scale(0.97); }
        
        .post-title-container { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-right: 12px; pointer-events: none; }
        .post-meta-container { display: flex; align-items: center; gap: 6px; flex-shrink: 0; pointer-events: none; }

        .pagination { display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--borderColor-muted); }
        .page-btn { padding: 6px 16px; border-radius: 20px; border: 1px solid var(--borderColor-muted); background: var(--color-canvas-subtle); cursor: pointer; font-size: 14px; transition: 0.2s; }
        .page-btn:hover:not(:disabled) { background: var(--color-accent-emphasis); color: white; }
        .page-btn:disabled { opacity: 0.4; cursor: not-allowed; }

        .copy-code-btn { position: absolute; top: 8px; right: 8px; padding: 4px 8px; font-size: 12px; color: var(--fgColor-muted); background: var(--color-canvas-default); border: 1px solid var(--borderColor-muted); border-radius: 6px; cursor: pointer; opacity: 0; }
        pre:hover .copy-code-btn { opacity: 1; }
        pre { position: relative; }

        #footer {margin-top:64px; text-align: center; font-size: small; color: var(--fgColor-muted);}

        @media (max-width: 600px) {
            body { margin: 10px; padding: 20px 15px; border-radius: 16px; border: none; box-shadow: none; }
            .title-left a { font-size: 24px !important; }
            .SideNav-item { padding: 12px 15px !important; }
        }
    </style>
</head>
<body>
    <div id="header">
        <div class="title-left">
            <img src="https://avatars.githubusercontent.com/u/64282354?v=4" class="avatar circle" id="avatarImg" alt="avatar">
            <a class="blogTitle" href="javascript:location.reload()">Hex Blog</a>
        </div>
        <div class="title-right">
            <a id="btnHome" class="btn btn-invisible circle" onclick="showList()" title="首页" style="display:none;"><svg class="octicon" width="16" height="16"><path id="pathHome"></path></svg></a>
            <a id="btnIssue" class="btn btn-invisible circle" target="_blank" title="Issue"><svg class="octicon" width="16" height="16"><path id="pathGitHub"></path></svg></a>
            <a class="btn btn-invisible circle" onclick="modeSwitch()" title="切换主题"><svg class="octicon" width="16" height="16"><path id="themeSwitch"></path></svg></a>
        </div>
    </div>

    <div id="post-list-view">
        <div style="margin-bottom: 16px; color: var(--fgColor-muted); font-weight: 500;">是生活玩弄了你，还是你享受了生活！</div>
        <nav class="SideNav" id="posts-container"><div style="padding:16px;">正在加载...</div></nav>
        <div class="pagination" id="pagination-ctrl" style="display:none;">
            <button class="page-btn" id="prev-page" onclick="changePage(-1)">上一页</button>
            <span id="page-info" style="font-weight:bold;">第 1 页</span>
            <button class="page-btn" id="next-page" onclick="changePage(1)">下一页</button>
        </div>
    </div>

    <div id="post-content-view" style="display:none;">
        <div class="postTitle" id="detail-title" style="margin-bottom: 24px; font-size: 28px; font-weight: 700; border-bottom: 1px solid var(--borderColor-muted); padding-bottom: 16px;"></div>
        <article id="post-detail" class="markdown-body"></article>
    </div>

    <div id="footer">
        <div id="footer2"><span id="runday"></span></div>
    </div>

<script>
    const CONFIG = {
        username: 'edc8',
        repo: 'edc8.github.io',
        startDate: '2025-01-19',
        perPage: 10
    };

    let currentPage = 1;
    let hasNextPage = true;
    let allIssues = [];

    const IconList = {
        sun: 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z',
        moon: 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z',
        home: 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z',
        github: 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z'
    };

    document.getElementById("pathHome").setAttribute("d", IconList.home);
    document.getElementById("pathGitHub").setAttribute("d", IconList.github);
    document.getElementById("btnIssue").href = `https://github.com/${CONFIG.username}/${CONFIG.repo}/issues`;

    function modeSwitch() {
        let currentMode = document.documentElement.getAttribute('data-color-mode');
        let newMode = currentMode === "light" ? "dark" : "light";
        localStorage.setItem("meek_theme", newMode);
        applyTheme(newMode);
    }

    function applyTheme(mode) {
        document.documentElement.setAttribute("data-color-mode", mode);
        document.getElementById("themeSwitch").setAttribute("d", mode === "light" ? IconList.sun : IconList.moon);
        document.getElementById("themeSwitch").parentNode.style.color = (mode === "light" ? "#ff5000" : "#00f0ff");
        document.getElementById("hljs-light").disabled = (mode === "dark");
        document.getElementById("hljs-dark").disabled = (mode === "light");
    }
    applyTheme(theme);

    const diffDay = Math.floor((new Date() - new Date(CONFIG.startDate)) / (1000 * 60 * 60 * 24));
    document.getElementById("runday").innerText = `已在星空运行 ${diffDay} 天`;

    async function fetchIssues(page = 1) {
        const container = document.getElementById('posts-container');
        container.innerHTML = `<div style="padding:16px;">正在加载...</div>`;
        try {
            const response = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/issues?creator=${CONFIG.username}&state=open&per_page=${CONFIG.perPage}&page=${page}`);
            const data = await response.json();
            if (data.length === 0 && page > 1) { hasNextPage = false; changePage(-1); return; }
            allIssues = data.filter(i => !i.pull_request).map(i => {
                const dateMatch = i.body ? i.body.match(/(?:日期|Date)[:：]\s*(\d{4}-\d{2}-\d{2})/) : null;
                return {...i, displayDate: dateMatch ? dateMatch[1] : i.created_at.split('T')[0]};
            });
            hasNextPage = data.length === CONFIG.perPage;
            renderList();
            document.getElementById('page-info').innerText = `第 ${currentPage} 页`;
            document.getElementById('prev-page').disabled = (currentPage === 1);
            document.getElementById('next-page').disabled = !hasNextPage;
        } catch (e) { container.innerText = "加载失败，请刷新重试"; }
    }

    function renderList() {
        const container = document.getElementById('posts-container');
        container.innerHTML = '';
        allIssues.forEach((issue, index) => {
            const labelsHtml = issue.labels.map(l => `<span class="Label" style="background-color:#${l.color}; color:#fff; font-size:10px; padding:2px 6px; border-radius:10px;">${l.name}</span>`).join('');
            const item = document.createElement('a');
            item.className = 'SideNav-item';
            item.href = "javascript:void(0)";
            item.onclick = (e) => {
                e.preventDefault();
                showPost(index);
            };
            item.innerHTML = `
                <div class="post-title-container">
                    <span style="font-size:16px; font-weight:600; color:var(--fgColor-default);">${issue.title}</span>
                </div>
                <div class="post-meta-container">
                    ${labelsHtml}
                    <span class="post-date" style="color:var(--fgColor-muted); font-family:monospace; margin-left:4px;">${issue.displayDate}</span>
                </div>`;
            container.appendChild(item);
        });
        document.getElementById('pagination-ctrl').style.display = 'flex';
    }

    function changePage(delta) { currentPage += delta; fetchIssues(currentPage); window.scrollTo({top: 0, behavior: 'instant'}); }

    function showPost(index) {
        const issue = allIssues[index];
        document.getElementById('post-list-view').style.display = 'none';
        document.getElementById('post-content-view').style.display = 'block';
        document.getElementById('btnHome').style.display = 'flex';
        document.getElementById('detail-title').innerText = issue.title;
        let body = issue.body ? issue.body.replace(/(?:日期|Date)[:：]\s*\d{4}-\d{2}-\d{2}/, '').trim() : '';
        document.getElementById('post-detail').innerHTML = marked.parse(body);
        document.querySelectorAll('pre code').forEach((b) => hljs.highlightElement(b));
        addCopyButtons();
        window.scrollTo({top: 0, behavior: 'instant'});
    }

    function showList() {
        document.getElementById('post-list-view').style.display = 'block';
        document.getElementById('post-content-view').style.display = 'none';
        document.getElementById('btnHome').style.display = 'none';
        window.scrollTo({top: 0, behavior: 'instant'});
    }

    function addCopyButtons() {
        document.querySelectorAll('.markdown-body pre').forEach((pre) => {
            if(pre.querySelector('.copy-code-btn')) return;
            const btn = document.createElement('button');
            btn.className = 'copy-code-btn'; btn.innerText = 'Copy';
            btn.onclick = () => {
                navigator.clipboard.writeText(pre.querySelector('code').innerText).then(() => {
                    btn.innerText = 'Copied!'; setTimeout(() => btn.innerText = 'Copy', 2000);
                });
            };
            pre.appendChild(btn);
        });
    }

    fetchIssues(currentPage);
</script>
</body>
</html>
