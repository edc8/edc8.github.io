<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hex blog</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/Primer/21.0.7/primer.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <style>
        body { background-color: #f6f8fa; color: #1f2328; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif; line-height: 1.5; }
        .Header { background-color: #24292f; color: white; padding: 20px 0; margin-bottom: 30px; }
        .container { max-width: 800px; margin: 0 auto; padding: 0 20px; }
        .post-card { background: white; border: 1px solid #d0d7de; border-radius: 6px; padding: 20px; margin-bottom: 16px; cursor: pointer; transition: 0.2s ease; }
        .post-card:hover { border-color: #0969da; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .post-title { font-size: 20px; font-weight: 600; color: #0969da; margin: 0; }
        .post-meta { color: #636c76; font-size: 13px; margin-top: 10px; display: flex; align-items: center; gap: 12px; }
        .markdown-body { padding: 30px; background: white; border: 1px solid #d0d7de; border-radius: 6px; margin-bottom: 30px; }
        .label-tag { border-radius: 20px; padding: 2px 10px; font-size: 12px; font-weight: 500; border: 1px solid #d0d7de; }
        #post-content-view { display: none; }
        .back-btn { display: inline-block; margin-bottom: 20px; color: #0969da; cursor: pointer; font-weight: 500; }
        .loading-state { text-align: center; padding: 50px; color: #636c76; }
        footer { margin-top: 50px; padding: 40px 0; border-top: 1px solid #d0d7de; text-align: center; color: #636c76; font-size: 12px; }
        img { max-width: 100%; border-radius: 6px; }
    </style>
</head>
<body>

<div class="Header">
    <div class="container">
        <h1 id="blog-name" style="font-size: 26px; margin: 0; letter-spacing: 1px;">hex blog</h1>
    </div>
</div>

<div class="container">
    <div id="post-list-view">
        <div id="posts-container" class="loading-state">æ­£åœ¨åŒæ­¥ GitHub Issues æ–‡ç« ...</div>
    </div>

    <div id="post-content-view">
        <div class="back-btn" onclick="showList()">â† è¿”å›åˆ—è¡¨</div>
        <article id="post-detail" class="markdown-body"></article>
    </div>

    <footer>
        <p>Â© <span id="year"></span> hex blog</p>
        <p style="margin-top: 8px; opacity: 0.6;">åŸºäº GitHub Issues API æ„å»º</p>
    </footer>
</div>

<script>
    /**
     * å·²æŒ‰è¦æ±‚é…ç½®ï¼š
     * ä»“åº“å: edc8.github.io
     * æ ‡é¢˜: hex blog
     */
    const CONFIG = {
        username: 'edc8',           
        repo: 'edc8.github.io',     
        title: "hex blog"         
    };

    document.getElementById('year').innerText = new Date().getFullYear();

    let allIssues = [];

    // æ—¥æœŸæå–é€»è¾‘
    function getPostDate(issue) {
        // åŒ¹é…æ­£æ–‡é¦–è¡Œçš„ æ—¥æœŸï¼š2023-01-01 æˆ– Date: 2023-01-01
        const dateMatch = issue.body ? issue.body.match(/(?:æ—¥æœŸ|Date)[:ï¼š]\s*(\d{4}-\d{2}-\d{2})/) : null;
        return dateMatch ? dateMatch[1] : issue.created_at.split('T')[0];
    }

    async function fetchIssues() {
        try {
            const response = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/issues?creator=${CONFIG.username}&state=open&per_page=100`);
            if (!response.ok) throw new Error('API Error');
            
            const rawData = await response.json();
            
            // æ•°æ®é¢„å¤„ç†
            allIssues = rawData.filter(i => !i.pull_request).map(i => {
                return { ...i, displayDate: getPostDate(i) };
            });

            // æ ¸å¿ƒåŠŸèƒ½ï¼šæŒ‰è‡ªå®šä¹‰æ—¥æœŸæ’åº
            allIssues.sort((a, b) => new Date(b.displayDate) - new Date(a.displayDate));

            renderList();
        } catch (e) {
            document.getElementById('posts-container').innerHTML = `<div class="flash flash-error">æ— æ³•åŠ è½½æ–‡ç« ï¼Œè¯·æ£€æŸ¥ä»“åº“æ˜¯å¦ä¸º Public æˆ–ç½‘ç»œæ˜¯å¦æ­£å¸¸ã€‚</div>`;
        }
    }

    function renderList() {
        const container = document.getElementById('posts-container');
        if (allIssues.length === 0) {
            container.innerHTML = "æš‚æ— æ–‡ç« ã€‚è¯·åœ¨ GitHub Issues ä¸­åˆ›å»ºæ–° Issueã€‚";
            return;
        }
        container.innerHTML = '';
        
        allIssues.forEach((issue, index) => {
            const labels = issue.labels.map(l => 
                `<span class="label-tag" style="background: #${l.color}22; color: #${l.color}; border-color: #${l.color}66;">${l.name}</span>`
            ).join('');
            
            const card = document.createElement('div');
            card.className = 'post-card';
            card.onclick = () => showPost(index);
            card.innerHTML = `
                <div class="post-title">${issue.title}</div>
                <div class="post-meta">
                    <span>ğŸ“… ${issue.displayDate}</span>
                    <div style="margin-left:auto">${labels}</div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    function showPost(index) {
        const issue = allIssues[index];
        document.getElementById('post-list-view').style.display = 'none';
        document.getElementById('post-content-view').style.display = 'block';
        
        // æ¸…ç†æ­£æ–‡ä¸­çš„æ—¥æœŸå£°æ˜è¡Œ
        let cleanBody = issue.body.replace(/(?:æ—¥æœŸ|Date)[:ï¼š]\s*\d{4}-\d{2}-\d{2}/, '').trim();
        
        document.getElementById('post-detail').innerHTML = `
            <h1 style="border-bottom: 1px solid #d0d7de; padding-bottom: 10px; margin-bottom: 20px;">${issue.title}</h1>
            <div style="color: #636c76; margin-bottom: 30px; font-size: 14px;">
                å‘å¸ƒæ—¶é—´ï¼š${issue.displayDate}
            </div>
            <div>
                ${marked.parse(cleanBody)}
            </div>
        `;
        window.scrollTo(0, 0);
    }

    function showList() {
        document.getElementById('post-list-view').style.display = 'block';
        document.getElementById('post-content-view').style.display = 'none';
        window.scrollTo(0, 0);
    }

    fetchIssues();
</script>

</body>
</html>
