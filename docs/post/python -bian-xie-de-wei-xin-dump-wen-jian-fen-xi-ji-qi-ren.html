<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    
    <link rel="icon" href="https://avatars.githubusercontent.com/u/64282354?v=4"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="## 得益于AI技术的普及，让我这个非专业选手也能实现使用python开发出自己想要的功能
### 在此记录贴出代码用作备份的 
### 无自动回复功能版 
```python
import os
import time
import tkinter as tk
from tkinter import scrolledtext, messagebox
import requests
import json
from watchdog.observers import Observer
from watchdog.events import FileSystemEventHandler
import threading
import wxauto
import win32clipboard
import pythoncom


class DumpFileHandler(FileSystemEventHandler):
    def __init__(self, text_widget, upload_callback):
        self.text_widget = text_widget
        self.upload_callback = upload_callback
        self.event_processed = {}  

    def on_created(self, event):
        self.handle_event(event, '新文件创建')

    def on_modified(self, event):
        self.handle_event(event, '文件修改')

    def on_deleted(self, event):
        self.handle_event(event, '文件删除')

    def handle_event(self, event, event_type):
        if event.is_directory:
            return
        file_path = event.src_path
        if file_path.endswith(('.dump', '.bin', '.txt')):
            if file_path not in self.event_processed:
                self.text_widget.insert(tk.END, f'{event_type}: {file_path}\n')
                self.text_widget.yview(tk.END)
                self.upload_callback(filepath=file_path)  
                self.event_processed[file_path] = True
            else:
                print(f'已处理过 {file_path} 的{event_type}事件，跳过重复处理')


def upload(filepath: str) -> str:
    url = 'http://47.98.235.44:5005/upload'
    try:
        with open(filepath, 'rb') as file:
            files = [
                ('upload_dump', (os.path.basename(filepath), file, 'application/octet-stream'))
            ]
            response = requests.post(url, files=files)
            if response.status_code == 200:
                return response.text
            else:
                raise Exception(f'Upload failed with status code {response.status_code}')
    except Exception as e:
        raise Exception(f'Error uploading file: {str(e)}')


def analysis(uuid: str) -> str:
    url = 'http://47.98.235.44:5005/analysis'
    payload = json.dumps({'uuid': uuid})
    headers = {
        'Content-Type': 'application/json'
    }
    try:
        response = requests.post(url, headers=headers, data=payload)
        if response.status_code == 200:
            return response.text
        else:
            raise Exception(f'Analysis request failed with status code {response.status_code}')
    except Exception as e:
        raise Exception(f'Error sending analysis request: {str(e)}')


def copy_to_clipboard(output_text: tk.Text):
    try:
        root.clipboard_clear()
        result = output_text.get(1.0, tk.END).strip()
        root.clipboard_append(result)
        output_text.insert(tk.END, '分析结果已复制到剪贴板\n')
    except Exception as e:
        output_text.insert(tk.END, f'错误: 复制到剪贴board时发生错误: {str(e)}\n')


def process_file(filepath: str, output_text: tk.Text, target_group_name):
    def build_message(data):
        messages = []
        if data and data[0]:
            for item in data[0]:
                if isinstance(item, dict):
                    name = item.get('name', '')
                    values = item.get('value', [])
                    for value in values:
                        if isinstance(value, dict):
                            b = value.get('b', '')
                            messages.append(f'{name}: {b}')
        return '\n'.join(messages) if messages else None

    def handle_analysis_result(analysis_data):
        if analysis_data.get('code') == 200:
            data = analysis_data.get('data', [])
            result_message = build_message(data)
            if result_message:
                output_text.delete(1.0, tk.END)
                output_text.insert(tk.END, f'解析成功，返回数据:\n{result_message}\n')
                copy_to_clipboard(output_text)
                send_to_wechat(result_message, target_group_name)  # 调用发送微信消息的函数并传入群名称
                return result_message
            else:
                warning_message = '该数据暂未收录'
                output_text.delete(1.0, tk.END)
                output_text.insert(tk.END, warning_message + '\n')
                copy_to_clipboard(output_text)
                send_to_wechat(warning_message, target_group_name)  # 调用发送微信消息的函数并传入群名称
                return warning_message
        else:
            warning_message = f'警告: 解析失败: {analysis_data.get('message')}\n'
            output_text.delete(1.0, tk.END)
            output_text.insert(tk.END, warning_message)
            copy_to_clipboard(output_text)
            send_to_wechat(warning_message, target_group_name)  # 调用发送微信消息的函数并传入群名称
            return warning_message

    def handle_file_deletion(filepath):
        import subprocess
        import sys
        if sys.platform.startswith('win32'):
            command = f'del /f /q '{filepath}''
        else:
            command = f'rm -f '{filepath}''
        try:
            subprocess.run(command, shell=True, check=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
            output_text.insert(tk.END, f'文件 {filepath} 已成功删除\n')
        except subprocess.CalledProcessError as e:
            output_text.insert(tk.END, f'错误: 删除文件 {filepath} 时出错: {str(e)}\n')
        except Exception as e:
            output_text.insert(tk.END, f'其他错误: {str(e)}\n')

    try:
        result = upload(filepath)
        response_data = json.loads(result)
        uuid = response_data.get('uuid')
        if uuid:
            analysis_result = analysis(uuid)
            analysis_data = json.loads(analysis_result)
            message = handle_analysis_result(analysis_data)
            handle_file_deletion(filepath)
        else:
            warning_message = '警告: 未能获取UUID\n'
            output_text.delete(1.0, tk.END)
            output_text.insert(tk.END, warning_message)
            copy_to_clipboard(output_text)
            send_to_wechat(warning_message, target_group_name)  # 调用发送微信消息的函数并传入群名称
    except json.JSONDecodeError:
        output_text.delete(1.0, tk.END)
        output_text.insert(tk.END, '错误: 返回数据格式错误，无法解析JSON\n')
        send_to_wechat('错误: 返回数据格式错误，无法解析JSON\n', target_group_name)  # 调用发送微信消息的函数并传入群名称
    except Exception as e:
        output_text.delete(1.0, tk.END)
        output_text.insert(tk.END, f'错误: 发生错误: {str(e)}\n')
        send_to_wechat(f'错误: 发生错误: {str(e)}\n', target_group_name)  # 调用发送微信消息的函数并传入群名称


class MonitorApp:
    def __init__(self, master):
        self.master = master
        self.master.title('文件监控工具')
        self.master.geometry('500x450')  # 增加高度以容纳新组件

        self.label_group = tk.Label(master, text='目标群名称:')  # 新增标签
        self.label_group.pack(pady=10)

        self.group_entry = tk.Entry(master, width=50)  # 新增输入框
        self.group_entry.pack(pady=10)

        self.label = tk.Label(master, text='监控目录:')
        self.label.pack(pady=10)

        self.directory_entry = tk.Entry(master, width=50)
        self.directory_entry.pack(pady=10)

        self.start_button = tk.Button(master, text='开始监控', command=self.start_monitoring)
        self.start_button.pack(pady=10)

        self.stop_button = tk.Button(master, text='停止监控', command=self.stop_monitoring)
        self.stop_button.pack(pady=10)

        self.output_text = scrolledtext.ScrolledText(master, width=60, height=15)
        self.output_text.pack(pady=10)

        self.observer = None
        self.is_running = False

    def start_monitoring(self):
        group_name = self.group_entry.get().strip()  # 获取群名称
        directory = self.directory_entry.get().strip()
        if not os.path.isdir(directory):
            messagebox.showerror('错误', '请输入有效的目录路径！')
            return

        self.is_running = True
        self.output_text.insert(tk.END, f'开始监控目录: {directory}\n')
        self.output_text.yview(tk.END)

        event_handler = DumpFileHandler(self.output_text, lambda filepath: process_file(filepath, self.output_text, group_name))  # 传入群名称
        self.observer = Observer()
        self.observer.schedule(event_handler, directory, recursive=False)
        self.observer.start()
        threading.Thread(target=self.run_observer, daemon=True).start()

    def run_observer(self):
        try:
            while self.is_running:
                time.sleep(1)
        except Exception as e:
            self.output_text.insert(tk.END, f'监控出错: {str(e)}\n')
            self.output_text.yview(tk.END)

    def stop_monitoring(self):
        self.is_running = False
        if self.observer:
            self.observer.stop()
            self.observer.join()
        self.output_text.insert(tk.END, '监控已停止。">
<meta property="og:title" content="python 编写的微信dump文件分析机器人">
<meta property="og:description" content="## 得益于AI技术的普及，让我这个非专业选手也能实现使用python开发出自己想要的功能
### 在此记录贴出代码用作备份的 
### 无自动回复功能版 
```python
import os
import time
import tkinter as tk
from tkinter import scrolledtext, messagebox
import requests
import json
from watchdog.observers import Observer
from watchdog.events import FileSystemEventHandler
import threading
import wxauto
import win32clipboard
import pythoncom


class DumpFileHandler(FileSystemEventHandler):
    def __init__(self, text_widget, upload_callback):
        self.text_widget = text_widget
        self.upload_callback = upload_callback
        self.event_processed = {}  

    def on_created(self, event):
        self.handle_event(event, '新文件创建')

    def on_modified(self, event):
        self.handle_event(event, '文件修改')

    def on_deleted(self, event):
        self.handle_event(event, '文件删除')

    def handle_event(self, event, event_type):
        if event.is_directory:
            return
        file_path = event.src_path
        if file_path.endswith(('.dump', '.bin', '.txt')):
            if file_path not in self.event_processed:
                self.text_widget.insert(tk.END, f'{event_type}: {file_path}\n')
                self.text_widget.yview(tk.END)
                self.upload_callback(filepath=file_path)  
                self.event_processed[file_path] = True
            else:
                print(f'已处理过 {file_path} 的{event_type}事件，跳过重复处理')


def upload(filepath: str) -> str:
    url = 'http://47.98.235.44:5005/upload'
    try:
        with open(filepath, 'rb') as file:
            files = [
                ('upload_dump', (os.path.basename(filepath), file, 'application/octet-stream'))
            ]
            response = requests.post(url, files=files)
            if response.status_code == 200:
                return response.text
            else:
                raise Exception(f'Upload failed with status code {response.status_code}')
    except Exception as e:
        raise Exception(f'Error uploading file: {str(e)}')


def analysis(uuid: str) -> str:
    url = 'http://47.98.235.44:5005/analysis'
    payload = json.dumps({'uuid': uuid})
    headers = {
        'Content-Type': 'application/json'
    }
    try:
        response = requests.post(url, headers=headers, data=payload)
        if response.status_code == 200:
            return response.text
        else:
            raise Exception(f'Analysis request failed with status code {response.status_code}')
    except Exception as e:
        raise Exception(f'Error sending analysis request: {str(e)}')


def copy_to_clipboard(output_text: tk.Text):
    try:
        root.clipboard_clear()
        result = output_text.get(1.0, tk.END).strip()
        root.clipboard_append(result)
        output_text.insert(tk.END, '分析结果已复制到剪贴板\n')
    except Exception as e:
        output_text.insert(tk.END, f'错误: 复制到剪贴board时发生错误: {str(e)}\n')


def process_file(filepath: str, output_text: tk.Text, target_group_name):
    def build_message(data):
        messages = []
        if data and data[0]:
            for item in data[0]:
                if isinstance(item, dict):
                    name = item.get('name', '')
                    values = item.get('value', [])
                    for value in values:
                        if isinstance(value, dict):
                            b = value.get('b', '')
                            messages.append(f'{name}: {b}')
        return '\n'.join(messages) if messages else None

    def handle_analysis_result(analysis_data):
        if analysis_data.get('code') == 200:
            data = analysis_data.get('data', [])
            result_message = build_message(data)
            if result_message:
                output_text.delete(1.0, tk.END)
                output_text.insert(tk.END, f'解析成功，返回数据:\n{result_message}\n')
                copy_to_clipboard(output_text)
                send_to_wechat(result_message, target_group_name)  # 调用发送微信消息的函数并传入群名称
                return result_message
            else:
                warning_message = '该数据暂未收录'
                output_text.delete(1.0, tk.END)
                output_text.insert(tk.END, warning_message + '\n')
                copy_to_clipboard(output_text)
                send_to_wechat(warning_message, target_group_name)  # 调用发送微信消息的函数并传入群名称
                return warning_message
        else:
            warning_message = f'警告: 解析失败: {analysis_data.get('message')}\n'
            output_text.delete(1.0, tk.END)
            output_text.insert(tk.END, warning_message)
            copy_to_clipboard(output_text)
            send_to_wechat(warning_message, target_group_name)  # 调用发送微信消息的函数并传入群名称
            return warning_message

    def handle_file_deletion(filepath):
        import subprocess
        import sys
        if sys.platform.startswith('win32'):
            command = f'del /f /q '{filepath}''
        else:
            command = f'rm -f '{filepath}''
        try:
            subprocess.run(command, shell=True, check=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
            output_text.insert(tk.END, f'文件 {filepath} 已成功删除\n')
        except subprocess.CalledProcessError as e:
            output_text.insert(tk.END, f'错误: 删除文件 {filepath} 时出错: {str(e)}\n')
        except Exception as e:
            output_text.insert(tk.END, f'其他错误: {str(e)}\n')

    try:
        result = upload(filepath)
        response_data = json.loads(result)
        uuid = response_data.get('uuid')
        if uuid:
            analysis_result = analysis(uuid)
            analysis_data = json.loads(analysis_result)
            message = handle_analysis_result(analysis_data)
            handle_file_deletion(filepath)
        else:
            warning_message = '警告: 未能获取UUID\n'
            output_text.delete(1.0, tk.END)
            output_text.insert(tk.END, warning_message)
            copy_to_clipboard(output_text)
            send_to_wechat(warning_message, target_group_name)  # 调用发送微信消息的函数并传入群名称
    except json.JSONDecodeError:
        output_text.delete(1.0, tk.END)
        output_text.insert(tk.END, '错误: 返回数据格式错误，无法解析JSON\n')
        send_to_wechat('错误: 返回数据格式错误，无法解析JSON\n', target_group_name)  # 调用发送微信消息的函数并传入群名称
    except Exception as e:
        output_text.delete(1.0, tk.END)
        output_text.insert(tk.END, f'错误: 发生错误: {str(e)}\n')
        send_to_wechat(f'错误: 发生错误: {str(e)}\n', target_group_name)  # 调用发送微信消息的函数并传入群名称


class MonitorApp:
    def __init__(self, master):
        self.master = master
        self.master.title('文件监控工具')
        self.master.geometry('500x450')  # 增加高度以容纳新组件

        self.label_group = tk.Label(master, text='目标群名称:')  # 新增标签
        self.label_group.pack(pady=10)

        self.group_entry = tk.Entry(master, width=50)  # 新增输入框
        self.group_entry.pack(pady=10)

        self.label = tk.Label(master, text='监控目录:')
        self.label.pack(pady=10)

        self.directory_entry = tk.Entry(master, width=50)
        self.directory_entry.pack(pady=10)

        self.start_button = tk.Button(master, text='开始监控', command=self.start_monitoring)
        self.start_button.pack(pady=10)

        self.stop_button = tk.Button(master, text='停止监控', command=self.stop_monitoring)
        self.stop_button.pack(pady=10)

        self.output_text = scrolledtext.ScrolledText(master, width=60, height=15)
        self.output_text.pack(pady=10)

        self.observer = None
        self.is_running = False

    def start_monitoring(self):
        group_name = self.group_entry.get().strip()  # 获取群名称
        directory = self.directory_entry.get().strip()
        if not os.path.isdir(directory):
            messagebox.showerror('错误', '请输入有效的目录路径！')
            return

        self.is_running = True
        self.output_text.insert(tk.END, f'开始监控目录: {directory}\n')
        self.output_text.yview(tk.END)

        event_handler = DumpFileHandler(self.output_text, lambda filepath: process_file(filepath, self.output_text, group_name))  # 传入群名称
        self.observer = Observer()
        self.observer.schedule(event_handler, directory, recursive=False)
        self.observer.start()
        threading.Thread(target=self.run_observer, daemon=True).start()

    def run_observer(self):
        try:
            while self.is_running:
                time.sleep(1)
        except Exception as e:
            self.output_text.insert(tk.END, f'监控出错: {str(e)}\n')
            self.output_text.yview(tk.END)

    def stop_monitoring(self):
        self.is_running = False
        if self.observer:
            self.observer.stop()
            self.observer.join()
        self.output_text.insert(tk.END, '监控已停止。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://edc8.github.io/post/python%20-bian-xie-de-wei-xin-dump-wen-jian-fen-xi-ji-qi-ren.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/u/64282354?v=4">
<title>python 编写的微信dump文件分析机器人</title>
<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />


</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
.copy-feedback {
    display: none;
    position: absolute;
    top: 10px;
    right: 50px;
    color: var(--color-fg-on-emphasis);
    background-color: var(--color-fg-muted);
    border-radius: 3px;
    padding: 5px 8px;
    font-size: 12px;
}
</style>




<body>
    <div id="header">
<h1 class="postTitle">python 编写的微信dump文件分析机器人</h1>
<div class="title-right">
    <a href="https://edc8.github.io" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/edc8/edc8.github.io/issues/2" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><h2>得益于AI技术的普及，让我这个非专业选手也能实现使用python开发出自己想要的功能</h2>
<h3>在此记录贴出代码用作备份的</h3>
<h3>无自动回复功能版</h3>
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-s1">os</span>
<span class="pl-k">import</span> <span class="pl-s1">time</span>
<span class="pl-k">import</span> <span class="pl-s1">tkinter</span> <span class="pl-k">as</span> <span class="pl-s1">tk</span>
<span class="pl-k">from</span> <span class="pl-s1">tkinter</span> <span class="pl-k">import</span> <span class="pl-s1">scrolledtext</span>, <span class="pl-s1">messagebox</span>
<span class="pl-k">import</span> <span class="pl-s1">requests</span>
<span class="pl-k">import</span> <span class="pl-s1">json</span>
<span class="pl-k">from</span> <span class="pl-s1">watchdog</span>.<span class="pl-s1">observers</span> <span class="pl-k">import</span> <span class="pl-v">Observer</span>
<span class="pl-k">from</span> <span class="pl-s1">watchdog</span>.<span class="pl-s1">events</span> <span class="pl-k">import</span> <span class="pl-v">FileSystemEventHandler</span>
<span class="pl-k">import</span> <span class="pl-s1">threading</span>
<span class="pl-k">import</span> <span class="pl-s1">wxauto</span>
<span class="pl-k">import</span> <span class="pl-s1">win32clipboard</span>
<span class="pl-k">import</span> <span class="pl-s1">pythoncom</span>


<span class="pl-k">class</span> <span class="pl-v">DumpFileHandler</span>(<span class="pl-v">FileSystemEventHandler</span>):
    <span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>, <span class="pl-s1">text_widget</span>, <span class="pl-s1">upload_callback</span>):
        <span class="pl-s1">self</span>.<span class="pl-c1">text_widget</span> <span class="pl-c1">=</span> <span class="pl-s1">text_widget</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">upload_callback</span> <span class="pl-c1">=</span> <span class="pl-s1">upload_callback</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">event_processed</span> <span class="pl-c1">=</span> {}  

    <span class="pl-k">def</span> <span class="pl-en">on_created</span>(<span class="pl-s1">self</span>, <span class="pl-s1">event</span>):
        <span class="pl-s1">self</span>.<span class="pl-c1">handle_event</span>(<span class="pl-s1">event</span>, <span class="pl-s">'新文件创建'</span>)

    <span class="pl-k">def</span> <span class="pl-en">on_modified</span>(<span class="pl-s1">self</span>, <span class="pl-s1">event</span>):
        <span class="pl-s1">self</span>.<span class="pl-c1">handle_event</span>(<span class="pl-s1">event</span>, <span class="pl-s">'文件修改'</span>)

    <span class="pl-k">def</span> <span class="pl-en">on_deleted</span>(<span class="pl-s1">self</span>, <span class="pl-s1">event</span>):
        <span class="pl-s1">self</span>.<span class="pl-c1">handle_event</span>(<span class="pl-s1">event</span>, <span class="pl-s">'文件删除'</span>)

    <span class="pl-k">def</span> <span class="pl-en">handle_event</span>(<span class="pl-s1">self</span>, <span class="pl-s1">event</span>, <span class="pl-s1">event_type</span>):
        <span class="pl-k">if</span> <span class="pl-s1">event</span>.<span class="pl-c1">is_directory</span>:
            <span class="pl-k">return</span>
        <span class="pl-s1">file_path</span> <span class="pl-c1">=</span> <span class="pl-s1">event</span>.<span class="pl-c1">src_path</span>
        <span class="pl-k">if</span> <span class="pl-s1">file_path</span>.<span class="pl-c1">endswith</span>((<span class="pl-s">'.dump'</span>, <span class="pl-s">'.bin'</span>, <span class="pl-s">'.txt'</span>)):
            <span class="pl-k">if</span> <span class="pl-s1">file_path</span> <span class="pl-c1"><span class="pl-c1">not</span> <span class="pl-c1">in</span></span> <span class="pl-s1">self</span>.<span class="pl-c1">event_processed</span>:
                <span class="pl-s1">self</span>.<span class="pl-c1">text_widget</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f'<span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">event_type</span><span class="pl-kos">}</span></span>: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">file_path</span><span class="pl-kos">}</span></span><span class="pl-cce">\n</span>'</span>)
                <span class="pl-s1">self</span>.<span class="pl-c1">text_widget</span>.<span class="pl-c1">yview</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)
                <span class="pl-s1">self</span>.<span class="pl-c1">upload_callback</span>(<span class="pl-s1">filepath</span><span class="pl-c1">=</span><span class="pl-s1">file_path</span>)  
                <span class="pl-s1">self</span>.<span class="pl-c1">event_processed</span>[<span class="pl-s1">file_path</span>] <span class="pl-c1">=</span> <span class="pl-c1">True</span>
            <span class="pl-k">else</span>:
                <span class="pl-en">print</span>(<span class="pl-s">f"已处理过 <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">file_path</span><span class="pl-kos">}</span></span> 的<span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">event_type</span><span class="pl-kos">}</span></span>事件，跳过重复处理"</span>)


<span class="pl-k">def</span> <span class="pl-en">upload</span>(<span class="pl-s1">filepath</span>: <span class="pl-smi">str</span>) <span class="pl-c1">-&gt;</span> <span class="pl-smi">str</span>:
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"http://47.98.235.44:5005/upload"</span>
    <span class="pl-k">try</span>:
        <span class="pl-k">with</span> <span class="pl-en">open</span>(<span class="pl-s1">filepath</span>, <span class="pl-s">'rb'</span>) <span class="pl-k">as</span> <span class="pl-s1">file</span>:
            <span class="pl-s1">files</span> <span class="pl-c1">=</span> [
                (<span class="pl-s">'upload_dump'</span>, (<span class="pl-s1">os</span>.<span class="pl-c1">path</span>.<span class="pl-c1">basename</span>(<span class="pl-s1">filepath</span>), <span class="pl-s1">file</span>, <span class="pl-s">'application/octet-stream'</span>))
            ]
            <span class="pl-s1">response</span> <span class="pl-c1">=</span> <span class="pl-s1">requests</span>.<span class="pl-c1">post</span>(<span class="pl-s1">url</span>, <span class="pl-s1">files</span><span class="pl-c1">=</span><span class="pl-s1">files</span>)
            <span class="pl-k">if</span> <span class="pl-s1">response</span>.<span class="pl-c1">status_code</span> <span class="pl-c1">==</span> <span class="pl-c1">200</span>:
                <span class="pl-k">return</span> <span class="pl-s1">response</span>.<span class="pl-c1">text</span>
            <span class="pl-k">else</span>:
                <span class="pl-k">raise</span> <span class="pl-en">Exception</span>(<span class="pl-s">f"Upload failed with status code <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">response</span>.<span class="pl-c1">status_code</span><span class="pl-kos">}</span></span>"</span>)
    <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
        <span class="pl-k">raise</span> <span class="pl-en">Exception</span>(<span class="pl-s">f"Error uploading file: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span>"</span>)


<span class="pl-k">def</span> <span class="pl-en">analysis</span>(<span class="pl-s1">uuid</span>: <span class="pl-smi">str</span>) <span class="pl-c1">-&gt;</span> <span class="pl-smi">str</span>:
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"http://47.98.235.44:5005/analysis"</span>
    <span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s1">json</span>.<span class="pl-c1">dumps</span>({<span class="pl-s">"uuid"</span>: <span class="pl-s1">uuid</span>})
    <span class="pl-s1">headers</span> <span class="pl-c1">=</span> {
        <span class="pl-s">'Content-Type'</span>: <span class="pl-s">'application/json'</span>
    }
    <span class="pl-k">try</span>:
        <span class="pl-s1">response</span> <span class="pl-c1">=</span> <span class="pl-s1">requests</span>.<span class="pl-c1">post</span>(<span class="pl-s1">url</span>, <span class="pl-s1">headers</span><span class="pl-c1">=</span><span class="pl-s1">headers</span>, <span class="pl-s1">data</span><span class="pl-c1">=</span><span class="pl-s1">payload</span>)
        <span class="pl-k">if</span> <span class="pl-s1">response</span>.<span class="pl-c1">status_code</span> <span class="pl-c1">==</span> <span class="pl-c1">200</span>:
            <span class="pl-k">return</span> <span class="pl-s1">response</span>.<span class="pl-c1">text</span>
        <span class="pl-k">else</span>:
            <span class="pl-k">raise</span> <span class="pl-en">Exception</span>(<span class="pl-s">f"Analysis request failed with status code <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">response</span>.<span class="pl-c1">status_code</span><span class="pl-kos">}</span></span>"</span>)
    <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
        <span class="pl-k">raise</span> <span class="pl-en">Exception</span>(<span class="pl-s">f"Error sending analysis request: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span>"</span>)


<span class="pl-k">def</span> <span class="pl-en">copy_to_clipboard</span>(<span class="pl-s1">output_text</span>: <span class="pl-s1">tk</span>.<span class="pl-c1">Text</span>):
    <span class="pl-k">try</span>:
        <span class="pl-s1">root</span>.<span class="pl-c1">clipboard_clear</span>()
        <span class="pl-s1">result</span> <span class="pl-c1">=</span> <span class="pl-s1">output_text</span>.<span class="pl-c1">get</span>(<span class="pl-c1">1.0</span>, <span class="pl-s1">tk</span>.<span class="pl-c1">END</span>).<span class="pl-c1">strip</span>()
        <span class="pl-s1">root</span>.<span class="pl-c1">clipboard_append</span>(<span class="pl-s1">result</span>)
        <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">"分析结果已复制到剪贴板<span class="pl-cce">\n</span>"</span>)
    <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
        <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f"错误: 复制到剪贴board时发生错误: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span><span class="pl-cce">\n</span>"</span>)


<span class="pl-k">def</span> <span class="pl-en">process_file</span>(<span class="pl-s1">filepath</span>: <span class="pl-smi">str</span>, <span class="pl-s1">output_text</span>: <span class="pl-s1">tk</span>.<span class="pl-c1">Text</span>, <span class="pl-s1">target_group_name</span>):
    <span class="pl-k">def</span> <span class="pl-en">build_message</span>(<span class="pl-s1">data</span>):
        <span class="pl-s1">messages</span> <span class="pl-c1">=</span> []
        <span class="pl-k">if</span> <span class="pl-s1">data</span> <span class="pl-c1">and</span> <span class="pl-s1">data</span>[<span class="pl-c1">0</span>]:
            <span class="pl-k">for</span> <span class="pl-s1">item</span> <span class="pl-c1">in</span> <span class="pl-s1">data</span>[<span class="pl-c1">0</span>]:
                <span class="pl-k">if</span> <span class="pl-en">isinstance</span>(<span class="pl-s1">item</span>, <span class="pl-s1">dict</span>):
                    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s1">item</span>.<span class="pl-c1">get</span>(<span class="pl-s">"name"</span>, <span class="pl-s">""</span>)
                    <span class="pl-s1">values</span> <span class="pl-c1">=</span> <span class="pl-s1">item</span>.<span class="pl-c1">get</span>(<span class="pl-s">"value"</span>, [])
                    <span class="pl-k">for</span> <span class="pl-s1">value</span> <span class="pl-c1">in</span> <span class="pl-s1">values</span>:
                        <span class="pl-k">if</span> <span class="pl-en">isinstance</span>(<span class="pl-s1">value</span>, <span class="pl-s1">dict</span>):
                            <span class="pl-s1">b</span> <span class="pl-c1">=</span> <span class="pl-s1">value</span>.<span class="pl-c1">get</span>(<span class="pl-s">"b"</span>, <span class="pl-s">""</span>)
                            <span class="pl-s1">messages</span>.<span class="pl-c1">append</span>(<span class="pl-s">f"<span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">name</span><span class="pl-kos">}</span></span>: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">b</span><span class="pl-kos">}</span></span>"</span>)
        <span class="pl-k">return</span> <span class="pl-s">"<span class="pl-cce">\n</span>"</span>.<span class="pl-c1">join</span>(<span class="pl-s1">messages</span>) <span class="pl-k">if</span> <span class="pl-s1">messages</span> <span class="pl-k">else</span> <span class="pl-c1">None</span>

    <span class="pl-k">def</span> <span class="pl-en">handle_analysis_result</span>(<span class="pl-s1">analysis_data</span>):
        <span class="pl-k">if</span> <span class="pl-s1">analysis_data</span>.<span class="pl-c1">get</span>(<span class="pl-s">"code"</span>) <span class="pl-c1">==</span> <span class="pl-c1">200</span>:
            <span class="pl-s1">data</span> <span class="pl-c1">=</span> <span class="pl-s1">analysis_data</span>.<span class="pl-c1">get</span>(<span class="pl-s">"data"</span>, [])
            <span class="pl-s1">result_message</span> <span class="pl-c1">=</span> <span class="pl-en">build_message</span>(<span class="pl-s1">data</span>)
            <span class="pl-k">if</span> <span class="pl-s1">result_message</span>:
                <span class="pl-s1">output_text</span>.<span class="pl-c1">delete</span>(<span class="pl-c1">1.0</span>, <span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)
                <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f"解析成功，返回数据:<span class="pl-cce">\n</span><span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">result_message</span><span class="pl-kos">}</span></span><span class="pl-cce">\n</span>"</span>)
                <span class="pl-en">copy_to_clipboard</span>(<span class="pl-s1">output_text</span>)
                <span class="pl-en">send_to_wechat</span>(<span class="pl-s1">result_message</span>, <span class="pl-s1">target_group_name</span>)  <span class="pl-c"># 调用发送微信消息的函数并传入群名称</span>
                <span class="pl-k">return</span> <span class="pl-s1">result_message</span>
            <span class="pl-k">else</span>:
                <span class="pl-s1">warning_message</span> <span class="pl-c1">=</span> <span class="pl-s">"该数据暂未收录"</span>
                <span class="pl-s1">output_text</span>.<span class="pl-c1">delete</span>(<span class="pl-c1">1.0</span>, <span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)
                <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s1">warning_message</span> <span class="pl-c1">+</span> <span class="pl-s">"<span class="pl-cce">\n</span>"</span>)
                <span class="pl-en">copy_to_clipboard</span>(<span class="pl-s1">output_text</span>)
                <span class="pl-en">send_to_wechat</span>(<span class="pl-s1">warning_message</span>, <span class="pl-s1">target_group_name</span>)  <span class="pl-c"># 调用发送微信消息的函数并传入群名称</span>
                <span class="pl-k">return</span> <span class="pl-s1">warning_message</span>
        <span class="pl-k">else</span>:
            <span class="pl-s1">warning_message</span> <span class="pl-c1">=</span> <span class="pl-s">f"警告: 解析失败: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">analysis_data</span>.<span class="pl-c1">get</span>(<span class="pl-s">'message'</span>)<span class="pl-kos">}</span></span><span class="pl-cce">\n</span>"</span>
            <span class="pl-s1">output_text</span>.<span class="pl-c1">delete</span>(<span class="pl-c1">1.0</span>, <span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)
            <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s1">warning_message</span>)
            <span class="pl-en">copy_to_clipboard</span>(<span class="pl-s1">output_text</span>)
            <span class="pl-en">send_to_wechat</span>(<span class="pl-s1">warning_message</span>, <span class="pl-s1">target_group_name</span>)  <span class="pl-c"># 调用发送微信消息的函数并传入群名称</span>
            <span class="pl-k">return</span> <span class="pl-s1">warning_message</span>

    <span class="pl-k">def</span> <span class="pl-en">handle_file_deletion</span>(<span class="pl-s1">filepath</span>):
        <span class="pl-k">import</span> <span class="pl-s1">subprocess</span>
        <span class="pl-k">import</span> <span class="pl-s1">sys</span>
        <span class="pl-k">if</span> <span class="pl-s1">sys</span>.<span class="pl-c1">platform</span>.<span class="pl-c1">startswith</span>(<span class="pl-s">'win32'</span>):
            <span class="pl-s1">command</span> <span class="pl-c1">=</span> <span class="pl-s">f'del /f /q "<span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">filepath</span><span class="pl-kos">}</span></span>"'</span>
        <span class="pl-k">else</span>:
            <span class="pl-s1">command</span> <span class="pl-c1">=</span> <span class="pl-s">f'rm -f "<span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">filepath</span><span class="pl-kos">}</span></span>"'</span>
        <span class="pl-k">try</span>:
            <span class="pl-s1">subprocess</span>.<span class="pl-c1">run</span>(<span class="pl-s1">command</span>, <span class="pl-s1">shell</span><span class="pl-c1">=</span><span class="pl-c1">True</span>, <span class="pl-s1">check</span><span class="pl-c1">=</span><span class="pl-c1">True</span>, <span class="pl-s1">stdout</span><span class="pl-c1">=</span><span class="pl-s1">subprocess</span>.<span class="pl-c1">PIPE</span>, <span class="pl-s1">stderr</span><span class="pl-c1">=</span><span class="pl-s1">subprocess</span>.<span class="pl-c1">PIPE</span>)
            <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f"文件 <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">filepath</span><span class="pl-kos">}</span></span> 已成功删除<span class="pl-cce">\n</span>"</span>)
        <span class="pl-k">except</span> <span class="pl-s1">subprocess</span>.<span class="pl-c1">CalledProcessError</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
            <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f"错误: 删除文件 <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">filepath</span><span class="pl-kos">}</span></span> 时出错: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span><span class="pl-cce">\n</span>"</span>)
        <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
            <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f"其他错误: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span><span class="pl-cce">\n</span>"</span>)

    <span class="pl-k">try</span>:
        <span class="pl-s1">result</span> <span class="pl-c1">=</span> <span class="pl-en">upload</span>(<span class="pl-s1">filepath</span>)
        <span class="pl-s1">response_data</span> <span class="pl-c1">=</span> <span class="pl-s1">json</span>.<span class="pl-c1">loads</span>(<span class="pl-s1">result</span>)
        <span class="pl-s1">uuid</span> <span class="pl-c1">=</span> <span class="pl-s1">response_data</span>.<span class="pl-c1">get</span>(<span class="pl-s">"uuid"</span>)
        <span class="pl-k">if</span> <span class="pl-s1">uuid</span>:
            <span class="pl-s1">analysis_result</span> <span class="pl-c1">=</span> <span class="pl-en">analysis</span>(<span class="pl-s1">uuid</span>)
            <span class="pl-s1">analysis_data</span> <span class="pl-c1">=</span> <span class="pl-s1">json</span>.<span class="pl-c1">loads</span>(<span class="pl-s1">analysis_result</span>)
            <span class="pl-s1">message</span> <span class="pl-c1">=</span> <span class="pl-en">handle_analysis_result</span>(<span class="pl-s1">analysis_data</span>)
            <span class="pl-en">handle_file_deletion</span>(<span class="pl-s1">filepath</span>)
        <span class="pl-k">else</span>:
            <span class="pl-s1">warning_message</span> <span class="pl-c1">=</span> <span class="pl-s">"警告: 未能获取UUID<span class="pl-cce">\n</span>"</span>
            <span class="pl-s1">output_text</span>.<span class="pl-c1">delete</span>(<span class="pl-c1">1.0</span>, <span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)
            <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s1">warning_message</span>)
            <span class="pl-en">copy_to_clipboard</span>(<span class="pl-s1">output_text</span>)
            <span class="pl-en">send_to_wechat</span>(<span class="pl-s1">warning_message</span>, <span class="pl-s1">target_group_name</span>)  <span class="pl-c"># 调用发送微信消息的函数并传入群名称</span>
    <span class="pl-k">except</span> <span class="pl-s1">json</span>.<span class="pl-c1">JSONDecodeError</span>:
        <span class="pl-s1">output_text</span>.<span class="pl-c1">delete</span>(<span class="pl-c1">1.0</span>, <span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)
        <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">"错误: 返回数据格式错误，无法解析JSON<span class="pl-cce">\n</span>"</span>)
        <span class="pl-en">send_to_wechat</span>(<span class="pl-s">"错误: 返回数据格式错误，无法解析JSON<span class="pl-cce">\n</span>"</span>, <span class="pl-s1">target_group_name</span>)  <span class="pl-c"># 调用发送微信消息的函数并传入群名称</span>
    <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
        <span class="pl-s1">output_text</span>.<span class="pl-c1">delete</span>(<span class="pl-c1">1.0</span>, <span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)
        <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f"错误: 发生错误: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span><span class="pl-cce">\n</span>"</span>)
        <span class="pl-en">send_to_wechat</span>(<span class="pl-s">f"错误: 发生错误: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span><span class="pl-cce">\n</span>"</span>, <span class="pl-s1">target_group_name</span>)  <span class="pl-c"># 调用发送微信消息的函数并传入群名称</span>


<span class="pl-k">class</span> <span class="pl-v">MonitorApp</span>:
    <span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>, <span class="pl-s1">master</span>):
        <span class="pl-s1">self</span>.<span class="pl-c1">master</span> <span class="pl-c1">=</span> <span class="pl-s1">master</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">master</span>.<span class="pl-c1">title</span>(<span class="pl-s">"文件监控工具"</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">master</span>.<span class="pl-c1">geometry</span>(<span class="pl-s">"500x450"</span>)  <span class="pl-c"># 增加高度以容纳新组件</span>

        <span class="pl-s1">self</span>.<span class="pl-c1">label_group</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Label</span>(<span class="pl-s1">master</span>, <span class="pl-s1">text</span><span class="pl-c1">=</span><span class="pl-s">"目标群名称:"</span>)  <span class="pl-c"># 新增标签</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">label_group</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">group_entry</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Entry</span>(<span class="pl-s1">master</span>, <span class="pl-s1">width</span><span class="pl-c1">=</span><span class="pl-c1">50</span>)  <span class="pl-c"># 新增输入框</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">group_entry</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">label</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Label</span>(<span class="pl-s1">master</span>, <span class="pl-s1">text</span><span class="pl-c1">=</span><span class="pl-s">"监控目录:"</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">label</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">directory_entry</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Entry</span>(<span class="pl-s1">master</span>, <span class="pl-s1">width</span><span class="pl-c1">=</span><span class="pl-c1">50</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">directory_entry</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">start_button</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Button</span>(<span class="pl-s1">master</span>, <span class="pl-s1">text</span><span class="pl-c1">=</span><span class="pl-s">"开始监控"</span>, <span class="pl-s1">command</span><span class="pl-c1">=</span><span class="pl-s1">self</span>.<span class="pl-c1">start_monitoring</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">start_button</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">stop_button</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Button</span>(<span class="pl-s1">master</span>, <span class="pl-s1">text</span><span class="pl-c1">=</span><span class="pl-s">"停止监控"</span>, <span class="pl-s1">command</span><span class="pl-c1">=</span><span class="pl-s1">self</span>.<span class="pl-c1">stop_monitoring</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">stop_button</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span> <span class="pl-c1">=</span> <span class="pl-s1">scrolledtext</span>.<span class="pl-c1">ScrolledText</span>(<span class="pl-s1">master</span>, <span class="pl-s1">width</span><span class="pl-c1">=</span><span class="pl-c1">60</span>, <span class="pl-s1">height</span><span class="pl-c1">=</span><span class="pl-c1">15</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">observer</span> <span class="pl-c1">=</span> <span class="pl-c1">None</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">is_running</span> <span class="pl-c1">=</span> <span class="pl-c1">False</span>

    <span class="pl-k">def</span> <span class="pl-en">start_monitoring</span>(<span class="pl-s1">self</span>):
        <span class="pl-s1">group_name</span> <span class="pl-c1">=</span> <span class="pl-s1">self</span>.<span class="pl-c1">group_entry</span>.<span class="pl-c1">get</span>().<span class="pl-c1">strip</span>()  <span class="pl-c"># 获取群名称</span>
        <span class="pl-s1">directory</span> <span class="pl-c1">=</span> <span class="pl-s1">self</span>.<span class="pl-c1">directory_entry</span>.<span class="pl-c1">get</span>().<span class="pl-c1">strip</span>()
        <span class="pl-k">if</span> <span class="pl-c1">not</span> <span class="pl-s1">os</span>.<span class="pl-c1">path</span>.<span class="pl-c1">isdir</span>(<span class="pl-s1">directory</span>):
            <span class="pl-s1">messagebox</span>.<span class="pl-c1">showerror</span>(<span class="pl-s">"错误"</span>, <span class="pl-s">"请输入有效的目录路径！"</span>)
            <span class="pl-k">return</span>

        <span class="pl-s1">self</span>.<span class="pl-c1">is_running</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f'开始监控目录: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">directory</span><span class="pl-kos">}</span></span><span class="pl-cce">\n</span>'</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>.<span class="pl-c1">yview</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)

        <span class="pl-s1">event_handler</span> <span class="pl-c1">=</span> <span class="pl-en">DumpFileHandler</span>(<span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>, <span class="pl-k">lambda</span> <span class="pl-s1">filepath</span>: <span class="pl-en">process_file</span>(<span class="pl-s1">filepath</span>, <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>, <span class="pl-s1">group_name</span>))  <span class="pl-c"># 传入群名称</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">observer</span> <span class="pl-c1">=</span> <span class="pl-en">Observer</span>()
        <span class="pl-s1">self</span>.<span class="pl-c1">observer</span>.<span class="pl-c1">schedule</span>(<span class="pl-s1">event_handler</span>, <span class="pl-s1">directory</span>, <span class="pl-s1">recursive</span><span class="pl-c1">=</span><span class="pl-c1">False</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">observer</span>.<span class="pl-c1">start</span>()
        <span class="pl-s1">threading</span>.<span class="pl-c1">Thread</span>(<span class="pl-s1">target</span><span class="pl-c1">=</span><span class="pl-s1">self</span>.<span class="pl-c1">run_observer</span>, <span class="pl-s1">daemon</span><span class="pl-c1">=</span><span class="pl-c1">True</span>).<span class="pl-c1">start</span>()

    <span class="pl-k">def</span> <span class="pl-en">run_observer</span>(<span class="pl-s1">self</span>):
        <span class="pl-k">try</span>:
            <span class="pl-k">while</span> <span class="pl-s1">self</span>.<span class="pl-c1">is_running</span>:
                <span class="pl-s1">time</span>.<span class="pl-c1">sleep</span>(<span class="pl-c1">1</span>)
        <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
            <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f'监控出错: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span><span class="pl-cce">\n</span>'</span>)
            <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>.<span class="pl-c1">yview</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)

    <span class="pl-k">def</span> <span class="pl-en">stop_monitoring</span>(<span class="pl-s1">self</span>):
        <span class="pl-s1">self</span>.<span class="pl-c1">is_running</span> <span class="pl-c1">=</span> <span class="pl-c1">False</span>
        <span class="pl-k">if</span> <span class="pl-s1">self</span>.<span class="pl-c1">observer</span>:
            <span class="pl-s1">self</span>.<span class="pl-c1">observer</span>.<span class="pl-c1">stop</span>()
            <span class="pl-s1">self</span>.<span class="pl-c1">observer</span>.<span class="pl-c1">join</span>()
        <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">'监控已停止。<span class="pl-cce">\n</span>'</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>.<span class="pl-c1">yview</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)


<span class="pl-k">def</span> <span class="pl-en">get_clipboard_content</span>():
    <span class="pl-s1">win32clipboard</span>.<span class="pl-c1">OpenClipboard</span>()
    <span class="pl-s1">data</span> <span class="pl-c1">=</span> <span class="pl-s1">win32clipboard</span>.<span class="pl-c1">GetClipboardData</span>(<span class="pl-s1">win32clipboard</span>.<span class="pl-c1">CF_TEXT</span>)
    <span class="pl-s1">win32clipboard</span>.<span class="pl-c1">CloseClipboard</span>()
    <span class="pl-k">return</span> <span class="pl-s1">data</span>.<span class="pl-c1">decode</span>(<span class="pl-s">'utf-8'</span>)


<span class="pl-k">def</span> <span class="pl-en">send_to_wechat</span>(<span class="pl-s1">message</span>, <span class="pl-s1">target_group_name</span>):  <span class="pl-c"># 接收群名称作为参数</span>
    <span class="pl-s1">pythoncom</span>.<span class="pl-c1">CoInitialize</span>()
    <span class="pl-s1">wechat</span> <span class="pl-c1">=</span> <span class="pl-s1">wxauto</span>.<span class="pl-c1">WeChat</span>()
    <span class="pl-s1">session_list</span> <span class="pl-c1">=</span> <span class="pl-s1">wechat</span>.<span class="pl-c1">GetSessionList</span>()
    <span class="pl-s1">target_group_session</span> <span class="pl-c1">=</span> <span class="pl-c1">None</span>
    <span class="pl-k">for</span> <span class="pl-s1">session</span> <span class="pl-c1">in</span> <span class="pl-s1">session_list</span>:
        <span class="pl-k">if</span> <span class="pl-s1">target_group_name</span> <span class="pl-c1">in</span> <span class="pl-s1">session</span>:
            <span class="pl-s1">target_group_session</span> <span class="pl-c1">=</span> <span class="pl-s1">session</span>
            <span class="pl-k">break</span>
    <span class="pl-k">if</span> <span class="pl-s1">target_group_session</span>:
        <span class="pl-c"># 先选中目标群会话</span>
        <span class="pl-s1">wechat</span>.<span class="pl-c1">ChatWith</span>(<span class="pl-s1">target_group_session</span>)
        <span class="pl-c"># 向目标群会话发送消息</span>
        <span class="pl-s1">wechat</span>.<span class="pl-c1">SendMsg</span>(<span class="pl-s1">message</span>)


<span class="pl-k">if</span> <span class="pl-s1">__name__</span> <span class="pl-c1">==</span> <span class="pl-s">"__main__"</span>:
    <span class="pl-s1">root</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Tk</span>()
    <span class="pl-s1">app</span> <span class="pl-c1">=</span> <span class="pl-en">MonitorApp</span>(<span class="pl-s1">root</span>)
    <span class="pl-s1">root</span>.<span class="pl-c1">mainloop</span>()</pre></div>
<h2>有关键词自动回复功能版；</h2>
<h2>两个版本的回复思路完全不一样，同时这也是编程逻辑的魅力所在。</h2>
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-k">import</span> <span class="pl-s1">os</span>
<span class="pl-k">import</span> <span class="pl-s1">time</span>
<span class="pl-k">import</span> <span class="pl-s1">tkinter</span> <span class="pl-k">as</span> <span class="pl-s1">tk</span>
<span class="pl-k">from</span> <span class="pl-s1">tkinter</span> <span class="pl-k">import</span> <span class="pl-s1">scrolledtext</span>, <span class="pl-s1">messagebox</span>
<span class="pl-k">import</span> <span class="pl-s1">requests</span>
<span class="pl-k">import</span> <span class="pl-s1">json</span>
<span class="pl-k">from</span> <span class="pl-s1">watchdog</span>.<span class="pl-s1">observers</span> <span class="pl-k">import</span> <span class="pl-v">Observer</span>
<span class="pl-k">from</span> <span class="pl-s1">watchdog</span>.<span class="pl-s1">events</span> <span class="pl-k">import</span> <span class="pl-v">FileSystemEventHandler</span>
<span class="pl-k">import</span> <span class="pl-s1">threading</span>
<span class="pl-k">import</span> <span class="pl-s1">wxauto</span>
<span class="pl-k">import</span> <span class="pl-s1">win32clipboard</span>
<span class="pl-k">import</span> <span class="pl-s1">pythoncom</span>
<span class="pl-k">import</span> <span class="pl-s1">logging</span>
<span class="pl-k">from</span> <span class="pl-s1">datetime</span> <span class="pl-k">import</span> <span class="pl-s1">datetime</span>


<span class="pl-c"># 设置日志记录为输出到命令行</span>
<span class="pl-s1">logging</span>.<span class="pl-c1">basicConfig</span>(<span class="pl-s1">level</span><span class="pl-c1">=</span><span class="pl-s1">logging</span>.<span class="pl-c1">INFO</span>, <span class="pl-s1">format</span><span class="pl-c1">=</span><span class="pl-s">'%(asctime)s - %(levelname)s - %(message)s'</span>)
<span class="pl-s1">console_handler</span> <span class="pl-c1">=</span> <span class="pl-s1">logging</span>.<span class="pl-c1">StreamHandler</span>()
<span class="pl-s1">console_handler</span>.<span class="pl-c1">setLevel</span>(<span class="pl-s1">logging</span>.<span class="pl-c1">INFO</span>)
<span class="pl-s1">logging</span>.<span class="pl-c1">getLogger</span>().<span class="pl-c1">addHandler</span>(<span class="pl-s1">console_handler</span>)


<span class="pl-c"># 存储分析结果的全局变量</span>
<span class="pl-s1">analysis_result_content</span> <span class="pl-c1">=</span> <span class="pl-s">""</span>
<span class="pl-c"># 用于通知有新分析结果的事件</span>
<span class="pl-s1">new_result_event</span> <span class="pl-c1">=</span> <span class="pl-s1">threading</span>.<span class="pl-c1">Event</span>()


<span class="pl-k">class</span> <span class="pl-v">DumpFileHandler</span>(<span class="pl-v">FileSystemEventHandler</span>):
    <span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>, <span class="pl-s1">text_widget</span>, <span class="pl-s1">upload_callback</span>):
        <span class="pl-s1">self</span>.<span class="pl-c1">text_widget</span> <span class="pl-c1">=</span> <span class="pl-s1">text_widget</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">upload_callback</span> <span class="pl-c1">=</span> <span class="pl-s1">upload_callback</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">event_processed</span> <span class="pl-c1">=</span> {}  

    <span class="pl-k">def</span> <span class="pl-en">on_created</span>(<span class="pl-s1">self</span>, <span class="pl-s1">event</span>):
        <span class="pl-s1">self</span>.<span class="pl-c1">handle_event</span>(<span class="pl-s1">event</span>, <span class="pl-s">'新文件创建'</span>)

    <span class="pl-k">def</span> <span class="pl-en">on_modified</span>(<span class="pl-s1">self</span>, <span class="pl-s1">event</span>):
        <span class="pl-s1">self</span>.<span class="pl-c1">handle_event</span>(<span class="pl-s1">event</span>, <span class="pl-s">'文件修改'</span>)

    <span class="pl-k">def</span> <span class="pl-en">on_deleted</span>(<span class="pl-s1">self</span>, <span class="pl-s1">event</span>):
        <span class="pl-s1">self</span>.<span class="pl-c1">handle_event</span>(<span class="pl-s1">event</span>, <span class="pl-s">'文件删除'</span>)

    <span class="pl-k">def</span> <span class="pl-en">handle_event</span>(<span class="pl-s1">self</span>, <span class="pl-s1">event</span>, <span class="pl-s1">event_type</span>):
        <span class="pl-k">if</span> <span class="pl-s1">event</span>.<span class="pl-c1">is_directory</span>:
            <span class="pl-k">return</span>
        <span class="pl-s1">file_path</span> <span class="pl-c1">=</span> <span class="pl-s1">event</span>.<span class="pl-c1">src_path</span>
        <span class="pl-k">if</span> <span class="pl-s1">file_path</span>.<span class="pl-c1">endswith</span>((<span class="pl-s">'.dump'</span>, <span class="pl-s">'.bin'</span>, <span class="pl-s">'.txt'</span>)):
            <span class="pl-k">if</span> <span class="pl-s1">file_path</span> <span class="pl-c1"><span class="pl-c1">not</span> <span class="pl-c1">in</span></span> <span class="pl-s1">self</span>.<span class="pl-c1">event_processed</span>:
                <span class="pl-s1">self</span>.<span class="pl-c1">text_widget</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f'<span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">event_type</span><span class="pl-kos">}</span></span>: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">file_path</span><span class="pl-kos">}</span></span><span class="pl-cce">\n</span>'</span>)
                <span class="pl-s1">self</span>.<span class="pl-c1">text_widget</span>.<span class="pl-c1">yview</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)
                <span class="pl-s1">self</span>.<span class="pl-c1">upload_callback</span>(<span class="pl-s1">filepath</span><span class="pl-c1">=</span><span class="pl-s1">file_path</span>)  
                <span class="pl-s1">self</span>.<span class="pl-c1">event_processed</span>[<span class="pl-s1">file_path</span>] <span class="pl-c1">=</span> <span class="pl-c1">True</span>
            <span class="pl-k">else</span>:
                <span class="pl-en">print</span>(<span class="pl-s">f"已处理过 <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">file_path</span><span class="pl-kos">}</span></span> 的<span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">event_type</span><span class="pl-kos">}</span></span>事件，跳过重复处理"</span>)


<span class="pl-k">def</span> <span class="pl-en">upload</span>(<span class="pl-s1">filepath</span>: <span class="pl-smi">str</span>) <span class="pl-c1">-&gt;</span> <span class="pl-smi">str</span>:
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"http://47.98.235.44:5005/upload"</span>
    <span class="pl-k">try</span>:
        <span class="pl-k">with</span> <span class="pl-en">open</span>(<span class="pl-s1">filepath</span>, <span class="pl-s">'rb'</span>) <span class="pl-k">as</span> <span class="pl-s1">file</span>:
            <span class="pl-s1">files</span> <span class="pl-c1">=</span> [
                (<span class="pl-s">'upload_dump'</span>, (<span class="pl-s1">os</span>.<span class="pl-c1">path</span>.<span class="pl-c1">basename</span>(<span class="pl-s1">filepath</span>), <span class="pl-s1">file</span>, <span class="pl-s">'application/octet-stream'</span>))
            ]
            <span class="pl-s1">response</span> <span class="pl-c1">=</span> <span class="pl-s1">requests</span>.<span class="pl-c1">post</span>(<span class="pl-s1">url</span>, <span class="pl-s1">files</span><span class="pl-c1">=</span><span class="pl-s1">files</span>)
            <span class="pl-k">if</span> <span class="pl-s1">response</span>.<span class="pl-c1">status_code</span> <span class="pl-c1">==</span> <span class="pl-c1">200</span>:
                <span class="pl-k">return</span> <span class="pl-s1">response</span>.<span class="pl-c1">text</span>
            <span class="pl-k">else</span>:
                <span class="pl-k">raise</span> <span class="pl-en">Exception</span>(<span class="pl-s">f"Upload failed with status code <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">response</span>.<span class="pl-c1">status_code</span><span class="pl-kos">}</span></span>"</span>)
    <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
        <span class="pl-k">raise</span> <span class="pl-en">Exception</span>(<span class="pl-s">f"Error uploading file: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span>"</span>)


<span class="pl-k">def</span> <span class="pl-en">analysis</span>(<span class="pl-s1">uuid</span>: <span class="pl-smi">str</span>) <span class="pl-c1">-&gt;</span> <span class="pl-smi">str</span>:
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"http://47.98.235.44:5005/analysis"</span>
    <span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s1">json</span>.<span class="pl-c1">dumps</span>({<span class="pl-s">"uuid"</span>: <span class="pl-s1">uuid</span>})
    <span class="pl-s1">headers</span> <span class="pl-c1">=</span> {
        <span class="pl-s">'Content-Type'</span>: <span class="pl-s">'application/json'</span>
    }
    <span class="pl-k">try</span>:
        <span class="pl-s1">response</span> <span class="pl-c1">=</span> <span class="pl-s1">requests</span>.<span class="pl-c1">post</span>(<span class="pl-s1">url</span>, <span class="pl-s1">headers</span><span class="pl-c1">=</span><span class="pl-s1">headers</span>, <span class="pl-s1">data</span><span class="pl-c1">=</span><span class="pl-s1">payload</span>)
        <span class="pl-k">if</span> <span class="pl-s1">response</span>.<span class="pl-c1">status_code</span> <span class="pl-c1">==</span> <span class="pl-c1">200</span>:
            <span class="pl-k">return</span> <span class="pl-s1">response</span>.<span class="pl-c1">text</span>
        <span class="pl-k">else</span>:
            <span class="pl-k">raise</span> <span class="pl-en">Exception</span>(<span class="pl-s">f"Analysis request failed with status code <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">response</span>.<span class="pl-c1">status_code</span><span class="pl-kos">}</span></span>"</span>)
    <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
        <span class="pl-k">raise</span> <span class="pl-en">Exception</span>(<span class="pl-s">f"Error sending analysis request: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span>"</span>)


<span class="pl-k">def</span> <span class="pl-en">copy_to_clipboard</span>(<span class="pl-s1">output_text</span>: <span class="pl-s1">tk</span>.<span class="pl-c1">Text</span>):
    <span class="pl-k">try</span>:
        <span class="pl-s1">root</span>.<span class="pl-c1">clipboard_clear</span>()
        <span class="pl-s1">result</span> <span class="pl-c1">=</span> <span class="pl-s1">output_text</span>.<span class="pl-c1">get</span>(<span class="pl-c1">1.0</span>, <span class="pl-s1">tk</span>.<span class="pl-c1">END</span>).<span class="pl-c1">strip</span>()
        <span class="pl-s1">root</span>.<span class="pl-c1">clipboard_append</span>(<span class="pl-s1">result</span>)
        <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">"分析结果已复制到剪贴板<span class="pl-cce">\n</span>"</span>)
    <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
        <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f"错误: 复制到剪贴板时发生错误: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span><span class="pl-cce">\n</span>"</span>)


<span class="pl-k">def</span> <span class="pl-en">process_file</span>(<span class="pl-s1">filepath</span>: <span class="pl-smi">str</span>, <span class="pl-s1">output_text</span>: <span class="pl-s1">tk</span>.<span class="pl-c1">Text</span>, <span class="pl-s1">target_group_name</span>):
    <span class="pl-k">def</span> <span class="pl-en">build_message</span>(<span class="pl-s1">data</span>):
        <span class="pl-s1">messages</span> <span class="pl-c1">=</span> []
        <span class="pl-k">if</span> <span class="pl-s1">data</span> <span class="pl-c1">and</span> <span class="pl-s1">data</span>[<span class="pl-c1">0</span>]:
            <span class="pl-k">for</span> <span class="pl-s1">item</span> <span class="pl-c1">in</span> <span class="pl-s1">data</span>[<span class="pl-c1">0</span>]:
                <span class="pl-k">if</span> <span class="pl-en">isinstance</span>(<span class="pl-s1">item</span>, <span class="pl-s1">dict</span>):
                    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s1">item</span>.<span class="pl-c1">get</span>(<span class="pl-s">"name"</span>, <span class="pl-s">""</span>)
                    <span class="pl-s1">values</span> <span class="pl-c1">=</span> <span class="pl-s1">item</span>.<span class="pl-c1">get</span>(<span class="pl-s">"value"</span>, [])
                    <span class="pl-k">for</span> <span class="pl-s1">value</span> <span class="pl-c1">in</span> <span class="pl-s1">values</span>:
                        <span class="pl-k">if</span> <span class="pl-en">isinstance</span>(<span class="pl-s1">value</span>, <span class="pl-s1">dict</span>):
                            <span class="pl-s1">b</span> <span class="pl-c1">=</span> <span class="pl-s1">value</span>.<span class="pl-c1">get</span>(<span class="pl-s">"b"</span>, <span class="pl-s">""</span>)
                            <span class="pl-s1">messages</span>.<span class="pl-c1">append</span>(<span class="pl-s">f"<span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">name</span><span class="pl-kos">}</span></span>: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">b</span><span class="pl-kos">}</span></span>"</span>)
        <span class="pl-k">return</span> <span class="pl-s">"<span class="pl-cce">\n</span>"</span>.<span class="pl-c1">join</span>(<span class="pl-s1">messages</span>) <span class="pl-k">if</span> <span class="pl-s1">messages</span> <span class="pl-k">else</span> <span class="pl-c1">None</span>

    <span class="pl-k">def</span> <span class="pl-en">handle_analysis_result</span>(<span class="pl-s1">analysis_data</span>):
        <span class="pl-k">global</span> <span class="pl-s1">analysis_result_content</span>  <span class="pl-c"># 使用全局变量</span>
        <span class="pl-k">if</span> <span class="pl-s1">analysis_data</span>.<span class="pl-c1">get</span>(<span class="pl-s">"code"</span>) <span class="pl-c1">==</span> <span class="pl-c1">200</span>:
            <span class="pl-s1">data</span> <span class="pl-c1">=</span> <span class="pl-s1">analysis_data</span>.<span class="pl-c1">get</span>(<span class="pl-s">"data"</span>, [])
            <span class="pl-s1">result_message</span> <span class="pl-c1">=</span> <span class="pl-en">build_message</span>(<span class="pl-s1">data</span>)
            <span class="pl-k">if</span> <span class="pl-s1">result_message</span>:
                <span class="pl-s1">output_text</span>.<span class="pl-c1">delete</span>(<span class="pl-c1">1.0</span>, <span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)
                <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f"解析成功，返回数据:<span class="pl-cce">\n</span><span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">result_message</span><span class="pl-kos">}</span></span><span class="pl-cce">\n</span>"</span>)
                <span class="pl-en">copy_to_clipboard</span>(<span class="pl-s1">output_text</span>)
                <span class="pl-s1">analysis_result_content</span> <span class="pl-c1">=</span> <span class="pl-s1">result_message</span>  <span class="pl-c"># 更新全局变量</span>
                <span class="pl-en">send_to_wechat</span>(<span class="pl-s1">result_message</span>, <span class="pl-s1">target_group_name</span>)
                <span class="pl-s1">new_result_event</span>.<span class="pl-c1">set</span>()  <span class="pl-c"># 通知有新结果</span>
                <span class="pl-k">return</span> <span class="pl-s1">result_message</span>
            <span class="pl-k">else</span>:
                <span class="pl-s1">warning_message</span> <span class="pl-c1">=</span> <span class="pl-s">"该数据暂未收录"</span>
                <span class="pl-s1">output_text</span>.<span class="pl-c1">delete</span>(<span class="pl-c1">1.0</span>, <span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)
                <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s1">warning_message</span> <span class="pl-c1">+</span> <span class="pl-s">"<span class="pl-cce">\n</span>"</span>)
                <span class="pl-en">copy_to_clipboard</span>(<span class="pl-s1">output_text</span>)
                <span class="pl-s1">analysis_result_content</span> <span class="pl-c1">=</span> <span class="pl-s1">warning_message</span>  <span class="pl-c"># 更新全局变量</span>
                <span class="pl-en">send_to_wechat</span>(<span class="pl-s1">warning_message</span>, <span class="pl-s1">target_group_name</span>)
                <span class="pl-s1">new_result_event</span>.<span class="pl-c1">set</span>()  <span class="pl-c"># 通知有新结果</span>
                <span class="pl-k">return</span> <span class="pl-s1">warning_message</span>
        <span class="pl-k">else</span>:
            <span class="pl-s1">warning_message</span> <span class="pl-c1">=</span> <span class="pl-s">f"警告: 解析失败: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">analysis_data</span>.<span class="pl-c1">get</span>(<span class="pl-s">'message'</span>)<span class="pl-kos">}</span></span><span class="pl-cce">\n</span>"</span>
            <span class="pl-s1">output_text</span>.<span class="pl-c1">delete</span>(<span class="pl-c1">1.0</span>, <span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)
            <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s1">warning_message</span>)
            <span class="pl-en">copy_to_clipboard</span>(<span class="pl-s1">output_text</span>)
            <span class="pl-s1">analysis_result_content</span> <span class="pl-c1">=</span> <span class="pl-s1">warning_message</span>  <span class="pl-c"># 更新全局变量</span>
            <span class="pl-en">send_to_wechat</span>(<span class="pl-s1">warning_message</span>, <span class="pl-s1">target_group_name</span>)
            <span class="pl-s1">new_result_event</span>.<span class="pl-c1">set</span>()  <span class="pl-c"># 通知有新结果</span>
            <span class="pl-k">return</span> <span class="pl-s1">warning_message</span>

    <span class="pl-k">def</span> <span class="pl-en">handle_file_deletion</span>(<span class="pl-s1">filepath</span>):
        <span class="pl-k">import</span> <span class="pl-s1">subprocess</span>
        <span class="pl-k">import</span> <span class="pl-s1">sys</span>
        <span class="pl-k">if</span> <span class="pl-s1">sys</span>.<span class="pl-c1">platform</span>.<span class="pl-c1">startswith</span>(<span class="pl-s">'win32'</span>):
            <span class="pl-s1">command</span> <span class="pl-c1">=</span> <span class="pl-s">f'del /f /q "<span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">filepath</span><span class="pl-kos">}</span></span>"'</span>
        <span class="pl-k">else</span>:
            <span class="pl-s1">command</span> <span class="pl-c1">=</span> <span class="pl-s">f'rm -f "<span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">filepath</span><span class="pl-kos">}</span></span>"'</span>
        <span class="pl-k">try</span>:
            <span class="pl-s1">subprocess</span>.<span class="pl-c1">run</span>(<span class="pl-s1">command</span>, <span class="pl-s1">shell</span><span class="pl-c1">=</span><span class="pl-c1">True</span>, <span class="pl-s1">check</span><span class="pl-c1">=</span><span class="pl-c1">True</span>, <span class="pl-s1">stdout</span><span class="pl-c1">=</span><span class="pl-s1">subprocess</span>.<span class="pl-c1">PIPE</span>, <span class="pl-s1">stderr</span><span class="pl-c1">=</span><span class="pl-s1">subprocess</span>.<span class="pl-c1">PIPE</span>)
            <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f"文件 <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">filepath</span><span class="pl-kos">}</span></span> 已成功删除<span class="pl-cce">\n</span>"</span>)
        <span class="pl-k">except</span> <span class="pl-s1">subprocess</span>.<span class="pl-c1">CalledProcessError</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
            <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f"错误: 删除文件 <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">filepath</span><span class="pl-kos">}</span></span> 时出错: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span><span class="pl-cce">\n</span>"</span>)
        <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
            <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f"其他错误: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span><span class="pl-cce">\n</span>"</span>)

    <span class="pl-k">try</span>:
        <span class="pl-s1">result</span> <span class="pl-c1">=</span> <span class="pl-en">upload</span>(<span class="pl-s1">filepath</span>)
        <span class="pl-s1">response_data</span> <span class="pl-c1">=</span> <span class="pl-s1">json</span>.<span class="pl-c1">loads</span>(<span class="pl-s1">result</span>)
        <span class="pl-s1">uuid</span> <span class="pl-c1">=</span> <span class="pl-s1">response_data</span>.<span class="pl-c1">get</span>(<span class="pl-s">"uuid"</span>)
        <span class="pl-k">if</span> <span class="pl-s1">uuid</span>:
            <span class="pl-s1">analysis_result</span> <span class="pl-c1">=</span> <span class="pl-en">analysis</span>(<span class="pl-s1">uuid</span>)
            <span class="pl-s1">analysis_data</span> <span class="pl-c1">=</span> <span class="pl-s1">json</span>.<span class="pl-c1">loads</span>(<span class="pl-s1">analysis_result</span>)
            <span class="pl-s1">message</span> <span class="pl-c1">=</span> <span class="pl-en">handle_analysis_result</span>(<span class="pl-s1">analysis_data</span>)
            <span class="pl-en">handle_file_deletion</span>(<span class="pl-s1">filepath</span>)
        <span class="pl-k">else</span>:
            <span class="pl-s1">warning_message</span> <span class="pl-c1">=</span> <span class="pl-s">"警告: 未能获取UUID<span class="pl-cce">\n</span>"</span>
            <span class="pl-s1">output_text</span>.<span class="pl-c1">delete</span>(<span class="pl-c1">1.0</span>, <span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)
            <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s1">warning_message</span>)
            <span class="pl-en">copy_to_clipboard</span>(<span class="pl-s1">output_text</span>)
            <span class="pl-en">send_to_wechat</span>(<span class="pl-s1">warning_message</span>, <span class="pl-s1">target_group_name</span>)
    <span class="pl-k">except</span> <span class="pl-s1">json</span>.<span class="pl-c1">JSONDecodeError</span>:
        <span class="pl-s1">output_text</span>.<span class="pl-c1">delete</span>(<span class="pl-c1">1.0</span>, <span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)
        <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">"错误: 返回数据格式错误，无法解析JSON<span class="pl-cce">\n</span>"</span>)
        <span class="pl-en">send_to_wechat</span>(<span class="pl-s">"错误: 返回数据格式错误，无法解析JSON<span class="pl-cce">\n</span>"</span>, <span class="pl-s1">target_group_name</span>)
    <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
        <span class="pl-s1">output_text</span>.<span class="pl-c1">delete</span>(<span class="pl-c1">1.0</span>, <span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)
        <span class="pl-s1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f"错误: 发生错误: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span><span class="pl-cce">\n</span>"</span>)
        <span class="pl-en">send_to_wechat</span>(<span class="pl-s">f"错误: 发生错误: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span><span class="pl-cce">\n</span>"</span>, <span class="pl-s1">target_group_name</span>)


<span class="pl-k">def</span> <span class="pl-en">start_wechat_listener</span>(<span class="pl-s1">target_group_name</span>, <span class="pl-s1">keyword_reply_dict</span>):
    <span class="pl-s1">max_retries</span> <span class="pl-c1">=</span> <span class="pl-c1">5</span>  <span class="pl-c"># 最大重试次数</span>
    <span class="pl-s1">retry_delay</span> <span class="pl-c1">=</span> <span class="pl-c1">5</span>  <span class="pl-c"># 重试延迟（秒）</span>
    <span class="pl-s1">retries</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span>
    <span class="pl-k">while</span> <span class="pl-s1">retries</span> <span class="pl-c1">&lt;</span> <span class="pl-s1">max_retries</span>:
        <span class="pl-k">try</span>:
            <span class="pl-s1">pythoncom</span>.<span class="pl-c1">CoInitialize</span>()  <span class="pl-c"># 确保在使用 COM 之前初始化</span>
            <span class="pl-s1">wx</span> <span class="pl-c1">=</span> <span class="pl-s1">wxauto</span>.<span class="pl-c1">WeChat</span>()
            <span class="pl-s1">logging</span>.<span class="pl-c1">info</span>(<span class="pl-s">"&gt; 初始化成功，获取到已登录窗口"</span>)

            <span class="pl-s1">wx</span>.<span class="pl-c1">AddListenChat</span>(<span class="pl-s1">who</span><span class="pl-c1">=</span><span class="pl-s1">target_group_name</span>, <span class="pl-s1">savepic</span><span class="pl-c1">=</span><span class="pl-c1">False</span>)

            <span class="pl-s1">replied_messages</span> <span class="pl-c1">=</span> {}
            <span class="pl-s1">wait</span> <span class="pl-c1">=</span> <span class="pl-c1">1</span>
            <span class="pl-s1">reply_time_window</span> <span class="pl-c1">=</span> <span class="pl-c1">60</span>

            <span class="pl-k">while</span> <span class="pl-c1">True</span>:
                <span class="pl-s1">msgs</span> <span class="pl-c1">=</span> <span class="pl-s1">wx</span>.<span class="pl-c1">GetListenMessage</span>()
                <span class="pl-s1">new_messages</span> <span class="pl-c1">=</span> []
                <span class="pl-s1">current_time</span> <span class="pl-c1">=</span> <span class="pl-s1">time</span>.<span class="pl-c1">time</span>()

                <span class="pl-k">for</span> <span class="pl-s1">msg_identifier</span> <span class="pl-c1">in</span> <span class="pl-en">list</span>(<span class="pl-s1">replied_messages</span>.<span class="pl-c1">keys</span>()):
                    <span class="pl-k">if</span> <span class="pl-s1">current_time</span> <span class="pl-c1">-</span> <span class="pl-s1">replied_messages</span>[<span class="pl-s1">msg_identifier</span>] <span class="pl-c1">&gt;</span> <span class="pl-s1">reply_time_window</span>:
                        <span class="pl-k">del</span> <span class="pl-s1">replied_messages</span>[<span class="pl-s1">msg_identifier</span>]

                <span class="pl-k">for</span> <span class="pl-s1">chat</span> <span class="pl-c1">in</span> <span class="pl-s1">msgs</span>:
                    <span class="pl-s1">group_name</span> <span class="pl-c1">=</span> <span class="pl-s1">chat</span>.<span class="pl-c1">who</span>
                    <span class="pl-s1">group_msgs</span> <span class="pl-c1">=</span> <span class="pl-s1">msgs</span>.<span class="pl-c1">get</span>(<span class="pl-s1">chat</span>)

                    <span class="pl-k">for</span> <span class="pl-s1">msg</span> <span class="pl-c1">in</span> <span class="pl-s1">group_msgs</span>:
                        <span class="pl-s1">msgtype</span> <span class="pl-c1">=</span> <span class="pl-s1">msg</span>.<span class="pl-c1">type</span>
                        <span class="pl-s1">content</span> <span class="pl-c1">=</span> <span class="pl-s1">msg</span>.<span class="pl-c1">content</span>
                        <span class="pl-s1">msg_identifier</span> <span class="pl-c1">=</span> (<span class="pl-s1">chat</span>.<span class="pl-c1">who</span>, <span class="pl-s1">msg</span>.<span class="pl-c1">id</span>)

                        <span class="pl-s1">logging</span>.<span class="pl-c1">info</span>(<span class="pl-s">f"收到消息 - 群聊: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">group_name</span><span class="pl-kos">}</span></span>, 类型: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">msgtype</span><span class="pl-kos">}</span></span>, 内容: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">content</span><span class="pl-kos">}</span></span>"</span>)

                        <span class="pl-k">if</span> <span class="pl-s1">msgtype</span> <span class="pl-c1">==</span> <span class="pl-s">"friend"</span>:
                            <span class="pl-k">if</span> <span class="pl-s1">msg_identifier</span> <span class="pl-c1"><span class="pl-c1">not</span> <span class="pl-c1">in</span></span> <span class="pl-s1">replied_messages</span>:
                                <span class="pl-s1">new_messages</span>.<span class="pl-c1">append</span>((<span class="pl-s1">msg_identifier</span>, <span class="pl-s1">msg</span>))

                <span class="pl-k">for</span> <span class="pl-s1">msg_identifier</span>, <span class="pl-s1">msg</span> <span class="pl-c1">in</span> <span class="pl-s1">new_messages</span>:
                    <span class="pl-s1">content</span> <span class="pl-c1">=</span> <span class="pl-s1">msg</span>.<span class="pl-c1">content</span>.<span class="pl-c1">lower</span>()
                    <span class="pl-k">for</span> <span class="pl-s1">keyword</span>, <span class="pl-s1">reply</span> <span class="pl-c1">in</span> <span class="pl-s1">keyword_reply_dict</span>.<span class="pl-c1">items</span>():
                        <span class="pl-k">if</span> <span class="pl-s1">keyword</span> <span class="pl-c1">in</span> <span class="pl-s1">content</span>:
                            <span class="pl-s1">chat</span>.<span class="pl-c1">SendMsg</span>(<span class="pl-s1">reply</span>)
                            <span class="pl-s1">logging</span>.<span class="pl-c1">info</span>(<span class="pl-s">f"回复 <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">keyword</span><span class="pl-kos">}</span></span> 消息 - 群聊: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">chat</span>.<span class="pl-c1">who</span><span class="pl-kos">}</span></span>, 消息ID: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">msg</span>.<span class="pl-c1">id</span><span class="pl-kos">}</span></span>"</span>)
                            <span class="pl-k">break</span>
                    <span class="pl-k">if</span> <span class="pl-s1">content</span> <span class="pl-c1">==</span> <span class="pl-s">"[文件]"</span>:  <span class="pl-c"># 检查消息内容是否为 [文件]</span>
                        <span class="pl-k">try</span>:
                            <span class="pl-c"># 发送分析结果作为回复</span>
                            <span class="pl-s1">new_result_event</span>.<span class="pl-c1">wait</span>()  <span class="pl-c"># 等待新结果</span>
                            <span class="pl-s1">chat</span>.<span class="pl-c1">SendMsg</span>(<span class="pl-s1">analysis_result_content</span>)
                            <span class="pl-s1">logging</span>.<span class="pl-c1">info</span>(<span class="pl-s">f"回复 [文件] 消息 - 群聊: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">chat</span>.<span class="pl-c1">who</span><span class="pl-kos">}</span></span>, 消息ID: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">msg</span>.<span class="pl-c1">id</span><span class="pl-kos">}</span></span>"</span>)
                            <span class="pl-s1">new_result_event</span>.<span class="pl-c1">clear</span>()  <span class="pl-c"># 清除事件</span>
                        <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
                            <span class="pl-s1">logging</span>.<span class="pl-c1">error</span>(<span class="pl-s">f"发送回复消息时出错: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">e</span><span class="pl-kos">}</span></span>"</span>)

                    <span class="pl-s1">replied_messages</span>[<span class="pl-s1">msg_identifier</span>] <span class="pl-c1">=</span> <span class="pl-s1">current_time</span>

                <span class="pl-s1">time</span>.<span class="pl-c1">sleep</span>(<span class="pl-s1">wait</span>)
        <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
            <span class="pl-s1">logging</span>.<span class="pl-c1">error</span>(<span class="pl-s">f"发生异常: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">e</span><span class="pl-kos">}</span></span>"</span>)
            <span class="pl-s1">retries</span> <span class="pl-c1">+=</span> <span class="pl-c1">1</span>
            <span class="pl-s1">time</span>.<span class="pl-c1">sleep</span>(<span class="pl-s1">retry_delay</span>)  <span class="pl-c"># 延迟一段时间后重试</span>
        <span class="pl-k">finally</span>:
            <span class="pl-s1">pythoncom</span>.<span class="pl-c1">CoUninitialize</span>()  <span class="pl-c"># 确保在结束时反初始化</span>


<span class="pl-k">class</span> <span class="pl-v">MonitorApp</span>:
    <span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>, <span class="pl-s1">master</span>):
        <span class="pl-s1">self</span>.<span class="pl-c1">master</span> <span class="pl-c1">=</span> <span class="pl-s1">master</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">master</span>.<span class="pl-c1">title</span>(<span class="pl-s">"wxdump机器人"</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">master</span>.<span class="pl-c1">geometry</span>(<span class="pl-s">"500x550"</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">label_group</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Label</span>(<span class="pl-s1">master</span>, <span class="pl-s1">text</span><span class="pl-c1">=</span><span class="pl-s">"目标群名称:"</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">label_group</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">group_entry</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Entry</span>(<span class="pl-s1">master</span>, <span class="pl-s1">width</span><span class="pl-c1">=</span><span class="pl-c1">50</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">group_entry</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">label</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Label</span>(<span class="pl-s1">master</span>, <span class="pl-s1">text</span><span class="pl-c1">=</span><span class="pl-s">"监控目录:"</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">label</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">directory_entry</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Entry</span>(<span class="pl-s1">master</span>, <span class="pl-s1">width</span><span class="pl-c1">=</span><span class="pl-c1">50</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">directory_entry</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">keyword_frame</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Frame</span>(<span class="pl-s1">master</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">keyword_frame</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">add_keyword_button</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Button</span>(<span class="pl-s1">master</span>, <span class="pl-s1">text</span><span class="pl-c1">=</span><span class="pl-s">"添加关键词"</span>, <span class="pl-s1">command</span><span class="pl-c1">=</span><span class="pl-s1">self</span>.<span class="pl-c1">add_keyword_field</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">add_keyword_button</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">keyword_fields</span> <span class="pl-c1">=</span> []

        <span class="pl-s1">self</span>.<span class="pl-c1">start_button</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Button</span>(<span class="pl-s1">master</span>, <span class="pl-s1">text</span><span class="pl-c1">=</span><span class="pl-s">"开始监控"</span>, <span class="pl-s1">command</span><span class="pl-c1">=</span><span class="pl-s1">self</span>.<span class="pl-c1">start_monitoring</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">start_button</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">stop_button</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Button</span>(<span class="pl-s1">master</span>, <span class="pl-s1">text</span><span class="pl-c1">=</span><span class="pl-s">"停止监控"</span>, <span class="pl-s1">command</span><span class="pl-c1">=</span><span class="pl-s1">self</span>.<span class="pl-c1">stop_monitoring</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">stop_button</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span> <span class="pl-c1">=</span> <span class="pl-s1">scrolledtext</span>.<span class="pl-c1">ScrolledText</span>(<span class="pl-s1">master</span>, <span class="pl-s1">width</span><span class="pl-c1">=</span><span class="pl-c1">60</span>, <span class="pl-s1">height</span><span class="pl-c1">=</span><span class="pl-c1">15</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">10</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">observer</span> <span class="pl-c1">=</span> <span class="pl-c1">None</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">is_running</span> <span class="pl-c1">=</span> <span class="pl-c1">False</span>

    <span class="pl-k">def</span> <span class="pl-en">add_keyword_field</span>(<span class="pl-s1">self</span>):
        <span class="pl-s1">frame</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Frame</span>(<span class="pl-s1">self</span>.<span class="pl-c1">keyword_frame</span>)
        <span class="pl-s1">frame</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">pady</span><span class="pl-c1">=</span><span class="pl-c1">5</span>)

        <span class="pl-s1">keyword_label</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Label</span>(<span class="pl-s1">frame</span>, <span class="pl-s1">text</span><span class="pl-c1">=</span><span class="pl-s">"关键词:"</span>)
        <span class="pl-s1">keyword_label</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">side</span><span class="pl-c1">=</span><span class="pl-s1">tk</span>.<span class="pl-c1">LEFT</span>)
        <span class="pl-s1">keyword_entry</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Entry</span>(<span class="pl-s1">frame</span>, <span class="pl-s1">width</span><span class="pl-c1">=</span><span class="pl-c1">20</span>)
        <span class="pl-s1">keyword_entry</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">side</span><span class="pl-c1">=</span><span class="pl-s1">tk</span>.<span class="pl-c1">LEFT</span>)

        <span class="pl-s1">reply_label</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Label</span>(<span class="pl-s1">frame</span>, <span class="pl-s1">text</span><span class="pl-c1">=</span><span class="pl-s">"回复:"</span>)
        <span class="pl-s1">reply_label</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">side</span><span class="pl-c1">=</span><span class="pl-s1">tk</span>.<span class="pl-c1">LEFT</span>)
        <span class="pl-s1">reply_entry</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Entry</span>(<span class="pl-s1">frame</span>, <span class="pl-s1">width</span><span class="pl-c1">=</span><span class="pl-c1">20</span>)
        <span class="pl-s1">reply_entry</span>.<span class="pl-c1">pack</span>(<span class="pl-s1">side</span><span class="pl-c1">=</span><span class="pl-s1">tk</span>.<span class="pl-c1">LEFT</span>)

        <span class="pl-s1">self</span>.<span class="pl-c1">keyword_fields</span>.<span class="pl-c1">append</span>((<span class="pl-s1">keyword_entry</span>, <span class="pl-s1">reply_entry</span>))

    <span class="pl-k">def</span> <span class="pl-en">start_monitoring</span>(<span class="pl-s1">self</span>):
        <span class="pl-s1">group_name</span> <span class="pl-c1">=</span> <span class="pl-s1">self</span>.<span class="pl-c1">group_entry</span>.<span class="pl-c1">get</span>().<span class="pl-c1">strip</span>()
        <span class="pl-s1">base_directory</span> <span class="pl-c1">=</span> <span class="pl-s1">self</span>.<span class="pl-c1">directory_entry</span>.<span class="pl-c1">get</span>().<span class="pl-c1">strip</span>()
        <span class="pl-k">if</span> <span class="pl-c1">not</span> <span class="pl-s1">base_directory</span>:
            <span class="pl-s1">messagebox</span>.<span class="pl-c1">showerror</span>(<span class="pl-s">"错误"</span>, <span class="pl-s">"请输入有效的基础目录路径！"</span>)
            <span class="pl-k">return</span>

        <span class="pl-c"># 获取当前年月</span>
        <span class="pl-s1">current_year_month</span> <span class="pl-c1">=</span> <span class="pl-s1">datetime</span>.<span class="pl-c1">now</span>().<span class="pl-c1">strftime</span>(<span class="pl-s">"%Y-%m"</span>)
        <span class="pl-s1">directory</span> <span class="pl-c1">=</span> <span class="pl-s1">os</span>.<span class="pl-c1">path</span>.<span class="pl-c1">join</span>(<span class="pl-s1">base_directory</span>, <span class="pl-s1">current_year_month</span>)
        <span class="pl-k">if</span> <span class="pl-c1">not</span> <span class="pl-s1">os</span>.<span class="pl-c1">path</span>.<span class="pl-c1">isdir</span>(<span class="pl-s1">directory</span>):
            <span class="pl-s1">messagebox</span>.<span class="pl-c1">showerror</span>(<span class="pl-s">"错误"</span>, <span class="pl-s">"请确保目录存在或输入有效的基础目录路径！"</span>)
            <span class="pl-k">return</span>

        <span class="pl-s1">keyword_reply_dict</span> <span class="pl-c1">=</span> {}
        <span class="pl-k">for</span> <span class="pl-s1">keyword_entry</span>, <span class="pl-s1">reply_entry</span> <span class="pl-c1">in</span> <span class="pl-s1">self</span>.<span class="pl-c1">keyword_fields</span>:
            <span class="pl-s1">keyword</span> <span class="pl-c1">=</span> <span class="pl-s1">keyword_entry</span>.<span class="pl-c1">get</span>().<span class="pl-c1">strip</span>()
            <span class="pl-s1">reply</span> <span class="pl-c1">=</span> <span class="pl-s1">reply_entry</span>.<span class="pl-c1">get</span>().<span class="pl-c1">strip</span>()
            <span class="pl-k">if</span> <span class="pl-s1">keyword</span> <span class="pl-c1">and</span> <span class="pl-s1">reply</span>:
                <span class="pl-s1">keyword_reply_dict</span>[<span class="pl-s1">keyword</span>] <span class="pl-c1">=</span> <span class="pl-s1">reply</span>

        <span class="pl-s1">self</span>.<span class="pl-c1">is_running</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f'开始监控目录: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">directory</span><span class="pl-kos">}</span></span><span class="pl-cce">\n</span>'</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>.<span class="pl-c1">yview</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)

        <span class="pl-s1">event_handler</span> <span class="pl-c1">=</span> <span class="pl-en">DumpFileHandler</span>(<span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>, <span class="pl-k">lambda</span> <span class="pl-s1">filepath</span>: <span class="pl-en">process_file</span>(<span class="pl-s1">filepath</span>, <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>, <span class="pl-s1">group_name</span>))
        <span class="pl-s1">self</span>.<span class="pl-c1">observer</span> <span class="pl-c1">=</span> <span class="pl-en">Observer</span>()
        <span class="pl-s1">self</span>.<span class="pl-c1">observer</span>.<span class="pl-c1">schedule</span>(<span class="pl-s1">event_handler</span>, <span class="pl-s1">directory</span>, <span class="pl-s1">recursive</span><span class="pl-c1">=</span><span class="pl-c1">False</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">observer</span>.<span class="pl-c1">start</span>()
        <span class="pl-s1">threading</span>.<span class="pl-c1">Thread</span>(<span class="pl-s1">target</span><span class="pl-c1">=</span><span class="pl-s1">self</span>.<span class="pl-c1">run_observer</span>, <span class="pl-s1">daemon</span><span class="pl-c1">=</span><span class="pl-c1">True</span>).<span class="pl-c1">start</span>()

        <span class="pl-c"># 启动微信监听线程</span>
        <span class="pl-s1">threading</span>.<span class="pl-c1">Thread</span>(<span class="pl-s1">target</span><span class="pl-c1">=</span><span class="pl-s1">start_wechat_listener</span>, <span class="pl-s1">args</span><span class="pl-c1">=</span>(<span class="pl-s1">group_name</span>, <span class="pl-s1">keyword_reply_dict</span>), <span class="pl-s1">daemon</span><span class="pl-c1">=</span><span class="pl-c1">True</span>).<span class="pl-c1">start</span>()

    <span class="pl-k">def</span> <span class="pl-en">run_observer</span>(<span class="pl-s1">self</span>):
        <span class="pl-k">try</span>:
            <span class="pl-k">while</span> <span class="pl-s1">self</span>.<span class="pl-c1">is_running</span>:
                <span class="pl-s1">time</span>.<span class="pl-c1">sleep</span>(<span class="pl-c1">1</span>)
        <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
            <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">f'监控出错: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-en">str</span>(<span class="pl-s1">e</span>)<span class="pl-kos">}</span></span><span class="pl-cce">\n</span>'</span>)
            <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>.<span class="pl-c1">yview</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)

    <span class="pl-k">def</span> <span class="pl-en">stop_monitoring</span>(<span class="pl-s1">self</span>):
        <span class="pl-s1">self</span>.<span class="pl-c1">is_running</span> <span class="pl-c1">=</span> <span class="pl-c1">False</span>
        <span class="pl-k">if</span> <span class="pl-s1">self</span>.<span class="pl-c1">observer</span>:
            <span class="pl-s1">self</span>.<span class="pl-c1">observer</span>.<span class="pl-c1">stop</span>()
            <span class="pl-s1">self</span>.<span class="pl-c1">observer</span>.<span class="pl-c1">join</span>()
        <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>.<span class="pl-c1">insert</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>, <span class="pl-s">'监控已停止。<span class="pl-cce">\n</span>'</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">output_text</span>.<span class="pl-c1">yview</span>(<span class="pl-s1">tk</span>.<span class="pl-c1">END</span>)


<span class="pl-k">def</span> <span class="pl-en">send_to_wechat</span>(<span class="pl-s1">message</span>, <span class="pl-s1">target_group_name</span>):
    <span class="pl-s1">pythoncom</span>.<span class="pl-c1">CoInitialize</span>()  <span class="pl-c"># 确保在使用 COM 之前初始化</span>
    <span class="pl-s1">wechat</span> <span class="pl-c1">=</span> <span class="pl-s1">wxauto</span>.<span class="pl-c1">WeChat</span>()
    <span class="pl-s1">session_list</span> <span class="pl-c1">=</span> <span class="pl-s1">wechat</span>.<span class="pl-c1">GetSessionList</span>()
    <span class="pl-s1">target_group_session</span> <span class="pl-c1">=</span> <span class="pl-c1">None</span>
    <span class="pl-k">for</span> <span class="pl-s1">session</span> <span class="pl-c1">in</span> <span class="pl-s1">session_list</span>:
        <span class="pl-k">if</span> <span class="pl-s1">target_group_name</span> <span class="pl-c1">in</span> <span class="pl-s1">session</span>:
            <span class="pl-s1">target_group_session</span> <span class="pl-c1">=</span> <span class="pl-s1">session</span>
            <span class="pl-k">break</span>
    <span class="pl-k">if</span> <span class="pl-s1">target_group_session</span>:
        <span class="pl-s1">wechat</span>.<span class="pl-c1">ChatWith</span>(<span class="pl-s1">target_group_session</span>)
        <span class="pl-s1">wechat</span>.<span class="pl-c1">SendMsg</span>(<span class="pl-s1">message</span>)
    <span class="pl-s1">pythoncom</span>.<span class="pl-c1">CoUninitialize</span>()  <span class="pl-c"># 确保在结束时反初始化</span>


<span class="pl-k">if</span> <span class="pl-s1">__name__</span> <span class="pl-c1">==</span> <span class="pl-s">"__main__"</span>:
    <span class="pl-s1">root</span> <span class="pl-c1">=</span> <span class="pl-s1">tk</span>.<span class="pl-c1">Tk</span>()
    <span class="pl-s1">app</span> <span class="pl-c1">=</span> <span class="pl-en">MonitorApp</span>(<span class="pl-s1">root</span>)
    <span class="pl-s1">root</span>.<span class="pl-c1">mainloop</span>()</pre></div>
<h2>实现效果图</h2>
<p><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/2109e62b71f4547df23f8ab088707ec892cd6c035d87973d2fd5277294c8b299/68747470733a2f2f707265766965772e636c6f75642e3138392e636e2f696d6167652f696d616765416374696f6e3f706172616d3d4233303044324630313346373545323043324135394339384641423842344436304438394445413943303438423442333246383535463038423241444333374344333642433231303935323238384331373736343944354230433643423739434138364339434345313736454430354136323045423945323845333836363738423538384331313232394537353038354341413846303238453344384141424532303133423735303246324338453241414437463838313935303832314236304339413241384237333543413038464645303232303932393041393446333243"><img src="https://camo.githubusercontent.com/2109e62b71f4547df23f8ab088707ec892cd6c035d87973d2fd5277294c8b299/68747470733a2f2f707265766965772e636c6f75642e3138392e636e2f696d6167652f696d616765416374696f6e3f706172616d3d4233303044324630313346373545323043324135394339384641423842344436304438394445413943303438423442333246383535463038423241444333374344333642433231303935323238384331373736343944354230433643423739434138364339434345313736454430354136323045423945323845333836363738423538384331313232394537353038354341413846303238453344384141424532303133423735303246324338453241414437463838313935303832314236304339413241384237333543413038464645303232303932393041393446333243" alt="Image" data-canonical-src="https://preview.cloud.189.cn/image/imageAction?param=B300D2F013F75E20C2A59C98FAB8B4D60D89DEA9C048B4B32F855F08B2ADC37CD36BC210952288C177649D5B0C6CB79CA86C9CCE176ED05A620EB9E28E386678B588C11229E75085CAA8F028E3D8AABE2013B7502F2C8E2AAD7F881950821B60C9A2A8B735CA08FFE02209290A94F32C" style="max-width: 100%;"></a></p>
<p><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/4cd7f5898888925617602512b959c56d70503285018c93082ef2b2a07e547689/68747470733a2f2f707265766965772e636c6f75642e3138392e636e2f696d6167652f696d616765416374696f6e3f706172616d3d3630453039314641373337393838453639353730304541304136373643384131354239304234443441353545464131314438323532374632444239374346373541303333333130373341434144394530444437333939323346344632444346313244413436443838454643463139413438424337424331354243364545323844463942314535364138414233443533444634384134364632413942314130424138333146434139433045423437454437423135443839303644323432353037424542303631363146424232323437423430453732353146433342324437323637"><img src="https://camo.githubusercontent.com/4cd7f5898888925617602512b959c56d70503285018c93082ef2b2a07e547689/68747470733a2f2f707265766965772e636c6f75642e3138392e636e2f696d6167652f696d616765416374696f6e3f706172616d3d3630453039314641373337393838453639353730304541304136373643384131354239304234443441353545464131314438323532374632444239374346373541303333333130373341434144394530444437333939323346344632444346313244413436443838454643463139413438424337424331354243364545323844463942314535364138414233443533444634384134364632413942314130424138333146434139433045423437454437423135443839303644323432353037424542303631363146424232323437423430453732353146433342324437323637" alt="Image" data-canonical-src="https://preview.cloud.189.cn/image/imageAction?param=60E091FA737988E695700EA0A676C8A15B90B4D4A55EFA11D82527F2DB97CF75A03331073ACAD9E0DD739923F4F2DCF12DA46D88EFCF19A48BC7BC15BC6EE28DF9B1E56A8AB3D53DF48A46F2A9B1A0BA831FCA9C0EB47ED7B15D8906D242507BEB06161FBB2247B40E7251FC3B2D7267" style="max-width: 100%;"></a></p></div>
<div style="font-size:small;margin-top:8px;float:right;"></div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="https://edc8.github.io">凡人日记</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if("01/19/2025"!=""){
    var startSite=new Date("01/19/2025");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行"+diffDay+"天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z', 'copy': 'M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z', 'check': 'M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","edc8/edc8.github.io");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const createClipboardHTML = (codeContent, additionalClasses = '') => `
        <pre class="notranslate"><code class="notranslate">${codeContent}</code></pre>
        <div class="clipboard-container position-absolute right-0 top-0 ${additionalClasses}">
            <clipboard-copy class="ClipboardButton btn m-2 p-0" role="button" style="display: inherit;">
                <svg height="16" width="16" class="octicon octicon-copy m-2"><path d="${IconList["copy"]}"></path></svg>
                <svg height="16" width="16" class="octicon octicon-check color-fg-success m-2 d-none"><path d="${IconList["check"]}"></path></svg>
            </clipboard-copy>
            <div class="copy-feedback">Copied!</div>
        </div>
    `;

    const handleCodeElements = (selector = '') => {
        document.querySelectorAll(selector).forEach(codeElement => {
            const codeContent = codeElement.innerHTML;
            const newStructure = document.createElement('div');
            newStructure.className = 'snippet-clipboard-content position-relative overflow-auto';
            newStructure.innerHTML = createClipboardHTML(codeContent);

            const parentElement = codeElement.parentElement;
            if (selector.includes('highlight')) {
                parentElement.insertBefore(newStructure, codeElement.nextSibling);
                parentElement.removeChild(codeElement);
            } else {
                parentElement.parentElement.replaceChild(newStructure, parentElement);
            }
        });
    };

    handleCodeElements('pre.notranslate > code.notranslate');
    handleCodeElements('div.highlight > pre.notranslate');

    let currentFeedback = null;
    document.querySelectorAll('clipboard-copy').forEach(copyButton => {
        copyButton.addEventListener('click', () => {
            const codeContent = copyButton.closest('.snippet-clipboard-content').innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = codeContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            const copyIcon = copyButton.querySelector('.octicon-copy');
            const checkIcon = copyButton.querySelector('.octicon-check');
            const copyFeedback = copyButton.nextElementSibling;

            if (currentFeedback && currentFeedback !== copyFeedback) {currentFeedback.style.display = 'none';}
            currentFeedback = copyFeedback;

            copyIcon.classList.add('d-none');
            checkIcon.classList.remove('d-none');
            copyFeedback.style.display = 'block';
            copyButton.style.borderColor = 'var(--color-success-fg)';

            setTimeout(() => {
                copyIcon.classList.remove('d-none');
                checkIcon.classList.add('d-none');
                copyFeedback.style.display = 'none';
                copyButton.style.borderColor = '';
            }, 2000);
        });
    });
});

</script>


</html>
